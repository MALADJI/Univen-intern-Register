<!-- ==================== ADMIN DASHBOARD ==================== -->
<app-navbar></app-navbar>

<div class="dashboard-wrapper pt-5">
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" [class.collapsed]="!isSidebarExpanded">
    <!-- User Profile Section -->
    <div class="sidebar-header pt-4">
      <div class="user-profile" *ngIf="isSidebarExpanded">
        <i class="bi bi-person-circle profile-image"></i>
        <div class="user-info">
          <h6 class="user-name">Welcome {{ admin?.name }}</h6>
          <p class="user-email">{{ admin?.email }}</p>
          <div class="user-meta mt-2">
            <span class="badge bg-danger-subtle text-danger me-1 mb-1" *ngIf="admin?.role">
              {{ admin?.role }}
            </span>
            <span class="badge bg-primary-subtle text-primary me-1 mb-1" *ngIf="admin?.Department">
              {{ admin?.Department }}
            </span>
          </div>
        </div>
      </div>
      <div class="user-profile-collapsed" *ngIf="!isSidebarExpanded">
        <i class="bi bi-person-circle profile-image-small"></i>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="sidebar-nav ">
      <ul class="nav-menu">
        <li *ngFor="let item of navigationItems" 
            class="nav-item" 
            [class.active]="activeSection === item.id">
          <a href="javascript:void(0)" 
             (click)="showSection(item.id)" 
             class="nav-link">
            <i [class]="item.icon"></i>
            <span class="nav-text" *ngIf="isSidebarExpanded">{{ item.label }}</span>
            <span *ngIf="item.id === 'Intern Leave status' && newLeaveRequestsCount > 0 && isSidebarExpanded" 
                  class="badge bg-danger rounded-pill notification-badge">
              {{ newLeaveRequestsCount }}
            </span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <!-- Logout Button -->
      <a href="javascript:void(0)" 
         (click)="logout()" 
         class="logout-link">
        <i class="bi bi-box-arrow-right"></i>
        <span class="nav-text" *ngIf="isSidebarExpanded">Log out</span>
      </a>

      <!-- Toggle Button -->
      <div class="sidebar-toggle-container">
        <button class="sidebar-toggle" 
                (click)="toggleSidebar()" 
                [title]="isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar'"
                [attr.aria-label]="isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar'">
          <i class="bi" [class.bi-chevron-left]="isSidebarExpanded" [class.bi-chevron-right]="!isSidebarExpanded"></i>
          <span class="visually-hidden">{{ isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar' }}</span>
        </button>
      </div>
    </div>
  </aside>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content" [class.sidebar-expanded]="isSidebarExpanded" [class.sidebar-collapsed]="!isSidebarExpanded">
    <div class="container py-4">

  <!-- ===================== OVERVIEW SECTION ===================== -->
  <div *ngIf="activeSection === 'overview'">

    <!-- Welcome Header -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 overview-header-card">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <h3 class="fw-bold text-primary mb-2">
              <i class="bi bi-speedometer2 me-2"></i>Dashboard Overview
            </h3>
            <p class="text-muted mb-0">Welcome back, {{ admin?.name }}! Here's a quick summary of your system.</p>
          </div>
          <div class="col-12 col-md-4 text-end mt-3 mt-md-0">
            <span class="badge bg-primary-subtle text-primary px-3 py-2 fs-6">
              <i class="bi bi-calendar3 me-1"></i>{{ currentDate }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== OVERVIEW CARDS ===== -->
    <div class="row g-4 mb-4">
      <div class="col-12 col-sm-6 col-md-4 col-lg-3" *ngFor="let stat of overviewStats">
        <div
          class="card overview-stat-card shadow-sm border-0 rounded-4 text-center py-4 h-100 hover-pointer"
          [class]="'stat-card-' + stat.color"
          (click)="openModal(stat)">
          <div class="card-body">
            <div class="stat-icon-wrapper mb-3">
              <div class="stat-icon" [class]="'bg-' + stat.color + '-subtle'">
                <i [class]="stat.icon + ' text-' + stat.color"></i>
              </div>
            </div>
            <h6 class="fw-semibold text-muted mb-2 text-uppercase small">{{ stat.label }}</h6>
            <p class="fs-2 fw-bold mb-0" [class]="'text-' + stat.color">{{ stat.value }}</p>
            <small class="text-muted d-block mt-2">
              <i class="bi bi-arrow-right-circle me-1"></i>Click to view details
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ADMIN MODAL ===== -->
    <div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">

          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="adminModalLabel">
              <i class="bi bi-person-badge-fill me-2"></i>{{ selectedStat?.label }}
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>

          <!-- ===== MODAL BODY ===== -->
          <div class="modal-body bg-light py-4">

            <!-- ===== DEFAULT VIEW ===== -->
            <div *ngIf="selectedStat?.label !== 'Absent' && selectedStat?.label !== 'On Leave'&& selectedStat?.label !== 'Present Today'; else leaveOrAbsentTable" class="text-center">
              <div class="fs-1 text-{{ selectedStat?.color }}">
                <i [class]="selectedStat?.icon"></i>
              </div>
              <h4 class="fw-bold mt-3">{{ selectedStat?.label }}</h4>
              <p class="display-6 fw-bold text-{{ selectedStat?.color }}">{{ selectedStat?.value }}</p>
            </div>

            <!-- ================= LEAVE / ABSENT / PRESENT MODAL ================= -->


            <ng-template #leaveOrAbsentTable>

              <!-- On Leave Section -->
              <ng-container *ngIf="selectedStat?.label === 'On Leave'">
                <ng-container *ngTemplateOutlet="onLeaveTemplate"></ng-container>
              </ng-container>

              <!-- Absent Section -->
              <ng-container *ngIf="selectedStat?.label === 'Absent'">
                <ng-container *ngTemplateOutlet="absentTemplate"></ng-container>
              </ng-container>

              <!-- Present Today Section -->
              <ng-container *ngIf="selectedStat?.label === 'Present Today'">
                <ng-container *ngTemplateOutlet="presentTemplate"></ng-container>
              </ng-container>

            </ng-template>

            <!-- ================= ON LEAVE TEMPLATE ================= -->
            <ng-template #onLeaveTemplate>
              <div class="card shadow-sm border-0 rounded-4 p-3">
                <h5 class="text-primary fw-bold mb-3">
                  <i class="bi bi-calendar-check me-2"></i>Recent Leave Requests
                </h5>

                <!-- Filters -->
                <div class="row g-3 align-items-end mb-3">
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Intern Name</label>
                    <input type="text" class="form-control" placeholder="Search by name..." [(ngModel)]="filterName" />
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Department</label>
                    <select class="form-select" [(ngModel)]="filterDepartment"
                            (change)="filteredFields = filterDepartment ? fieldMap[filterDepartment] : []; filterField = ''; currentPage = 1">
                      <option value="">All</option>
                      <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Field</label>
                    <select class="form-select" [(ngModel)]="filterField" (change)="currentPage = 1">
                      <option value="">All</option>
                      <option *ngFor="let field of filteredFields" [value]="field">{{ field }}</option>
                    </select>
                  </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                  <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                    <tr>
                      <th>Intern</th>
                      <th>Department</th>
                      <th>Field</th>
                      <th>Start Date</th>
                      <th>End Date</th>
                      <th>Reason</th>
                      <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let leave of paginatedLeaves">
                      <td>{{ leave.name }}</td>
                      <td>{{ leave.department }}</td>
                      <td>{{ leave.field }}</td>
                      <td>{{ leave.startDate }}</td>
                      <td>{{ leave.endDate }}</td>
                      <td>{{ leave.reason }}</td>
                      <td>
              <span class="badge rounded-pill"
                    [ngClass]="{
                      'bg-success': leave.status === 'Approved',
                      'bg-warning text-dark': leave.status === 'Pending',
                      'bg-danger': leave.status === 'Declined'
                    }">{{ leave.status }}</span>
                      </td>
                    </tr>
                    <tr *ngIf="paginatedLeaves.length === 0">
                      <td colspan="7" class="text-muted text-center">No leave records found.</td>
                    </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <button class="btn btn-outline-primary rounded-5" [disabled]="currentPage === 1" (click)="prevPage()">
                    <i class="bi bi-arrow-left-circle me-1"></i> Previous
                  </button>
                  <span class="fw-semibold text-muted">Page {{ currentPage }} of {{ totalPages }}</span>
                  <button class="btn btn-outline-primary rounded-5" [disabled]="currentPage === totalPages" (click)="nextPage()">
                    Next <i class="bi bi-arrow-right-circle ms-1"></i>
                  </button>
                </div>
              </div>
            </ng-template>

            <!-- ================= ABSENT TEMPLATE ================= -->
            <ng-template #absentTemplate>
              <div class="card shadow-sm border-0 rounded-4 p-3">
                <h5 class="text-danger fw-bold mb-3">
                  <i class="bi bi-graph-down me-2"></i>Intern Attendance Summary
                </h5>

                <!-- Filters -->
                <div class="row g-3 align-items-end mb-3">
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Intern Name</label>
                    <input type="text" class="form-control" placeholder="Search by name..." [(ngModel)]="attendanceFilterName" />
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Department</label>
                    <select class="form-select" [(ngModel)]="attendanceFilterDepartment" (change)="updateAttendanceFields()">
                      <option value="">All</option>
                      <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Field</label>
                    <select class="form-select" [(ngModel)]="attendanceFilterField">
                      <option value="">All</option>
                      <option *ngFor="let field of filteredAttendanceFields" [value]="field">{{ field }}</option>
                    </select>
                  </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                  <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                    <tr>
                      <th>Intern</th>
                      <th>Department</th>
                      <th>Field</th>
                      <th>Absent</th>
                      <th>Attendance %</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let data of paginatedAttendance">
                      <td>{{ data.name }}</td>
                      <td>{{ data.department }}</td>
                      <td>{{ data.field }}</td>
                      <td class="text-danger fw-semibold">{{ data.absent }}</td>
                      <td><span class="badge bg-primary">{{ data.attendanceRate }}%</span></td>
                    </tr>
                    <tr *ngIf="paginatedAttendance.length === 0">
                      <td colspan="7" class="text-center text-muted">No attendance records found.</td>
                    </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <button class="btn btn-outline-primary rounded-5" [disabled]="attendancePage === 1" (click)="prevAttendancePage()">
                    <i class="bi bi-arrow-left-circle me-1"></i> Previous
                  </button>
                  <span class="fw-semibold text-muted">Page {{ attendancePage }} of {{ totalAttendancePages }}</span>
                  <button class="btn btn-outline-primary rounded-5" [disabled]="attendancePage === totalAttendancePages" (click)="nextAttendancePage()">
                    Next <i class="bi bi-arrow-right-circle ms-1"></i>
                  </button>
                </div>
              </div>
            </ng-template>

            <!-- ================= PRESENT TODAY TEMPLATE ================= -->
            <ng-template #presentTemplate>
              <div class="card shadow-sm border-0 rounded-4 p-3">
                <h5 class="text-success fw-bold mb-3">
                  <i class="bi bi-graph-up-arrow me-2"></i>Present Interns Today
                </h5>

                <!-- Filters -->
                <div class="row g-3 align-items-end mb-3">
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Intern Name</label>
                    <input type="text" class="form-control" placeholder="Search by name..." [(ngModel)]="presentFilterName" />
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Department</label>
                    <select class="form-select" [(ngModel)]="presentFilterDepartment" (change)="updatePresentFields()">
                      <option value="">All Departments</option>
                      <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-4">
                    <label class="form-label fw-medium">Field</label>
                    <select class="form-select" [(ngModel)]="presentFilterField">
                      <option value="">All Fields</option>
                      <option *ngFor="let field of filteredPresentFields" [value]="field">{{ field }}</option>
                    </select>
                  </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                  <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                    <tr>
                      <th>Name</th>
                      <th>Department</th>
                      <th>Field</th>
                      <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let intern of paginatedPresentInterns">
                      <td>{{ intern.name }}</td>
                      <td>{{ intern.department }}</td>
                      <td>{{ intern.field }}</td>
                      <td>
                        <span class="badge rounded-pill bg-success" *ngIf="intern.status === 'Present'">Present</span>
                      </td>
                    </tr>
                    <tr *ngIf="paginatedPresentInterns.length === 0">
                      <td colspan="4" class="text-muted text-center">No interns found.</td>
                    </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <button class="btn btn-outline-primary rounded-5" [disabled]="presentPage === 1" (click)="prevPresentPage()">
                    <i class="bi bi-arrow-left-circle me-1"></i> Previous
                  </button>
                  <span class="fw-semibold text-muted">Page {{ presentPage }} of {{ totalPresentPages }}</span>
                  <button class="btn btn-outline-primary rounded-5" [disabled]="presentPage === totalPresentPages" (click)="nextPresentPage()">
                    Next <i class="bi bi-arrow-right-circle ms-1"></i>
                  </button>
                </div>
              </div>
            </ng-template>

          </div>
        </div>
      </div>
    </div>

    <!-- ===================== ATTENDANCE SUMMARY ===================== -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 overview-table-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-graph-up me-2"></i>Intern Attendance Summary
            </h5>
            <p class="text-muted small mb-0">Track attendance records for all interns</p>
          </div>
          <div class="mt-2 mt-md-0">
            <span class="badge bg-info text-white px-3 py-2">
              Total: {{ activeInternsCount }} interns
            </span>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 overview-table">
            <thead class="table-light">
            <tr>
              <th class="ps-4">Intern</th>
              <th>Department</th>
              <th class="text-center">
                <i class="bi bi-check-circle text-success me-1"></i>Present
              </th>
              <th class="text-center">
                <i class="bi bi-x-circle text-danger me-1"></i>Absent
              </th>
              <th class="text-center">
                <i class="bi bi-calendar-check text-warning me-1"></i>On Leave
              </th>
              <th class="text-center pe-4">
                <i class="bi bi-percent me-1"></i>Attendance %
              </th>
            </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of filteredOverviewAttendance; let i = index">
                <td class="ps-4">
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle me-2">
                      <span class="avatar-text">{{ data.name.charAt(0) }}</span>
                    </div>
                    <div>
                      <div class="fw-semibold">{{ data.name }}</div>
                      <small class="text-muted">{{ data.email || 'N/A' }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary-subtle text-secondary">{{ data.department }}</span>
                </td>
                <td class="text-center">
                  <span class="badge bg-success-subtle text-success fw-semibold">{{ data.present }}</span>
                </td>
                <td class="text-center">
                  <span class="badge bg-danger-subtle text-danger fw-semibold">{{ data.absent }}</span>
                </td>
                <td class="text-center">
                  <span class="badge bg-warning-subtle text-warning fw-semibold">{{ data.leave }}</span>
                </td>
                <td class="text-center pe-4">
                  <div class="d-flex align-items-center justify-content-center gap-2">
                    <div class="progress flex-grow-1 attendance-progress">
                      <div class="progress-bar" 
                           [class.bg-success]="data.attendanceRate >= 80"
                           [class.bg-warning]="data.attendanceRate >= 50 && data.attendanceRate < 80"
                           [class.bg-danger]="data.attendanceRate < 50"
                           [style.width.%]="data.attendanceRate">
                      </div>
                    </div>
                    <span class="badge attendance-badge" 
                          [class.bg-success]="data.attendanceRate >= 80"
                          [class.bg-warning]="data.attendanceRate >= 50 && data.attendanceRate < 80"
                          [class.bg-danger]="data.attendanceRate < 50">{{ data.attendanceRate }}%</span>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredOverviewAttendance.length === 0">
                <td colspan="6" class="text-center text-muted py-5">
                  <i class="bi bi-inbox fs-1 d-block mb-2 opacity-25"></i>
                  <p class="mb-0">No attendance records found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ===================== LEAVE OVERVIEW ===================== -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 overview-table-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-calendar-check me-2"></i>Recent Leave Requests
            </h5>
            <p class="text-muted small mb-0">Recent leave requests from your interns</p>
          </div>
          <div class="mt-2 mt-md-0">
            <button class="btn btn-primary btn-sm" (click)="showSection('Intern Leave status')">
              <i class="bi bi-arrow-right me-1"></i>View All
            </button>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 overview-table">
            <thead class="table-light">
            <tr>
              <th class="ps-4">Intern</th>
              <th>Department</th>
              <th>Field</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Reason</th>
              <th class="text-center pe-4">Status</th>
            </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leave of filteredOverviewLeaves">
                <td class="ps-4">
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle me-2">
                      <span class="avatar-text">{{ leave.name.charAt(0) }}</span>
                    </div>
                    <div class="fw-semibold">{{ leave.name }}</div>
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary-subtle text-secondary">{{ leave.department }}</span>
                </td>
                <td><small class="text-muted">{{ leave.field || '-' }}</small></td>
                <td><small class="fw-medium">{{ leave.startDate }}</small></td>
                <td><small class="fw-medium">{{ leave.endDate }}</small></td>
                <td>
                  <small class="text-truncate d-inline-block reason-text" [title]="leave.reason">
                    {{ leave.reason }}
                  </small>
                </td>
                <td class="text-center pe-4">
                  <span class="badge rounded-pill px-3 py-1"
                        [ngClass]="{
                          'bg-success': leave.status === 'Approved',
                          'bg-warning text-dark': leave.status === 'Pending',
                          'bg-danger': leave.status === 'Declined'
                        }">{{ leave.status }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="filteredOverviewLeaves.length === 0">
                <td colspan="7" class="text-center text-muted py-5">
                  <i class="bi bi-calendar-x fs-1 d-block mb-2 opacity-25"></i>
                  <p class="mb-0">No leave requests found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card-footer bg-white border-0 pt-3 pb-4 px-4" *ngIf="filteredOverviewLeaves.length > 0">
        <div class="text-center">
          <small class="text-muted">Showing {{ filteredOverviewLeaves.length }} recent requests</small>
          <button class="btn btn-link btn-sm p-0 ms-2" (click)="showSection('Intern Leave status')">
            View all leave requests <i class="bi bi-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- ===================== Manage Departments SECTION ===================== -->
  <div *ngIf="activeSection === Section.Departments" class="departments-section">

    <!-- Section Header -->
    <div class="card shadow-lg border-0 rounded-4 mb-4 department-header-card">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <div class="d-flex align-items-center mb-2">
              <div class="header-icon-wrapper me-3">
                <i class="bi bi-building-fill"></i>
              </div>
              <div>
                <h3 class="fw-bold text-primary mb-1">
                  Manage Departments & Fields
                </h3>
                <p class="text-muted mb-0 small">
                  <i class="bi bi-info-circle me-1"></i>Organize your organization by creating departments and adding fields to each department
                </p>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4 text-end mt-3 mt-md-0">
            <button class="btn btn-primary btn-lg rounded-5 shadow-sm department-add-btn" (click)="openAddDepartmentModal()">
              <i class="bi bi-plus-circle-fill me-2"></i> Add New Department
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-4">
      <div class="col-12 col-sm-6 col-md-4">
        <div class="card shadow-lg border-0 rounded-4 text-center py-4 h-100 vibrant-stat-card stat-card-blue">
          <div class="card-body">
            <div class="stat-icon-large mb-3">
              <i class="bi bi-building-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-2 small text-uppercase">Total Departments</h6>
            <p class="fs-1 fw-bold mb-0 stat-number-blue">{{ departmentList.length }}</p>
            <small class="text-muted d-block mt-2">
              <i class="bi bi-arrow-up-circle text-success me-1"></i>Active departments
            </small>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4">
        <div class="card shadow-lg border-0 rounded-4 text-center py-4 h-100 vibrant-stat-card stat-card-green">
          <div class="card-body">
            <div class="stat-icon-large mb-3">
              <i class="bi bi-tags-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-2 small text-uppercase">Total Fields</h6>
            <p class="fs-1 fw-bold mb-0 stat-number-green">{{ getTotalFields() }}</p>
            <small class="text-muted d-block mt-2">
              <i class="bi bi-list-check text-primary me-1"></i>All field types
            </small>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-4">
        <div class="card shadow-lg border-0 rounded-4 text-center py-4 h-100 vibrant-stat-card stat-card-purple">
          <div class="card-body">
            <div class="stat-icon-large mb-3">
              <i class="bi bi-graph-up-arrow"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-2 small text-uppercase">Avg Fields/Dept</h6>
            <p class="fs-1 fw-bold mb-0 stat-number-purple">{{ getAverageFieldsPerDepartment() }}</p>
            <small class="text-muted d-block mt-2">
              <i class="bi bi-calculator text-info me-1"></i>Average distribution
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filter -->
    <div class="card shadow-lg border-0 mb-4 rounded-4 vibrant-filter-card" *ngIf="departmentList.length > 0">
      <div class="card-header bg-gradient-primary text-white border-0 rounded-top-4">
        <div class="d-flex align-items-center">
          <i class="bi bi-funnel-fill me-2 fs-5"></i>
          <h6 class="fw-bold mb-0">Search & Filter Departments</h6>
        </div>
      </div>
      <div class="card-body p-4">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-6">
            <label class="form-label fw-semibold mb-2">
              <i class="bi bi-search text-primary me-1"></i>Search Departments
            </label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0">
                <i class="bi bi-building text-primary"></i>
              </span>
              <input
                type="text"
                class="form-control border-start-0"
                placeholder="Type department name to search..."
                [(ngModel)]="departmentSearch"
                (input)="updateFilteredDepartments()"/>
            </div>
            <small class="text-muted d-block mt-1">
              <i class="bi bi-lightbulb me-1"></i>Search by department name
            </small>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label fw-semibold mb-2">
              <i class="bi bi-funnel text-success me-1"></i>Filter by Status
            </label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0">
                <i class="bi bi-tags text-success"></i>
              </span>
              <select class="form-select border-start-0" [(ngModel)]="departmentFieldFilter" (change)="updateFilteredDepartments()" title="Filter departments by field count" aria-label="Filter departments by field count">
                <option value="">All Departments</option>
                <option value="has-fields">Has Fields</option>
                <option value="no-fields">No Fields</option>
              </select>
            </div>
            <small class="text-muted d-block mt-1">
              <i class="bi bi-info-circle me-1"></i>Filter by field availability
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredDepartmentList.length === 0 && departmentList.length === 0" class="card shadow-lg border-0 rounded-4 vibrant-empty-state">
      <div class="card-body text-center py-5">
        <div class="empty-state-icon-large mb-4">
          <i class="bi bi-building"></i>
        </div>
        <h4 class="fw-bold text-primary mb-2">Welcome to Department Management!</h4>
        <p class="text-muted mb-4 px-3">Start organizing your organization by creating departments. Each department can have multiple fields to categorize your interns.</p>
        <div class="d-flex flex-column flex-sm-row gap-2 justify-content-center">
          <button class="btn btn-primary btn-lg rounded-5 shadow-sm" (click)="openAddDepartmentModal()">
            <i class="bi bi-plus-circle-fill me-2"></i> Create Your First Department
          </button>
        </div>
        <div class="mt-4 pt-4 border-top">
          <small class="text-muted">
            <i class="bi bi-lightbulb-fill text-warning me-1"></i>
            <strong>Tip:</strong> Departments help organize interns by their work areas (e.g., ICT, Finance, Marketing)
          </small>
        </div>
      </div>
    </div>

    <!-- No Results State -->
    <div *ngIf="filteredDepartmentList.length === 0 && departmentList.length > 0" class="card shadow-lg border-0 rounded-4 vibrant-empty-state">
      <div class="card-body text-center py-5">
        <div class="empty-state-icon-large mb-4">
          <i class="bi bi-search text-warning"></i>
        </div>
        <h4 class="fw-bold text-muted mb-2">No Departments Found</h4>
        <p class="text-muted mb-4">No departments match your current search or filter criteria. Try adjusting your filters.</p>
        <button class="btn btn-outline-primary rounded-5 shadow-sm" (click)="departmentSearch = ''; departmentFieldFilter = ''; updateFilteredDepartments()">
          <i class="bi bi-arrow-repeat me-1"></i> Clear All Filters
        </button>
      </div>
    </div>

    <!-- Departments List - Table Format -->
    <div class="card shadow-lg border-0 rounded-4" *ngIf="filteredDepartmentList.length > 0">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold text-primary mb-0">
            <i class="bi bi-building-fill me-2"></i>Departments & Fields
          </h5>
          <span class="badge bg-info text-white px-3 py-2">
            {{ filteredDepartmentList.length }} Department{{ filteredDepartmentList.length !== 1 ? 's' : '' }}
          </span>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 modern-dept-table">
            <thead class="table-light">
              <tr>
                <th class="ps-4 dept-col-name">Department</th>
                <th class="text-center dept-col-count">Fields</th>
                <th class="dept-col-fields">Fields List</th>
                <th class="text-center dept-col-actions">Actions</th>
                <th class="pe-4 text-center dept-col-menu"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let dept of filteredDepartmentList; let i = index" class="modern-dept-table-row">
                <td class="ps-4">
                  <div class="d-flex align-items-center">
                    <div class="dept-icon-wrapper-table me-3">
                      <i class="bi bi-building-fill"></i>
                    </div>
                    <div>
                      <h6 class="fw-bold text-dark mb-0">{{ dept }}</h6>
                    </div>
                  </div>
                </td>
                <td class="text-center">
                  <span class="badge modern-field-count-badge-table">
                    {{ (fieldMap[dept] || []).length }}
                  </span>
                </td>
                <td>
                  <div *ngIf="(fieldMap[dept] || []).length === 0" class="text-muted">
                    <small><i class="bi bi-inbox me-1"></i>No fields</small>
                  </div>
                  <div *ngIf="(fieldMap[dept] || []).length > 0" class="d-flex flex-wrap gap-2">
                    <span *ngFor="let field of (fieldMap[dept] || []); let j = index" class="modern-field-badge-table">
                      <span class="field-name-table">{{ field }}</span>
                      <button class="btn btn-link btn-sm p-0 ms-1 field-edit-btn-table" (click)="editField(dept, j)" title="Edit field" aria-label="Edit field">
                        <i class="bi bi-pencil-fill"></i>
                      </button>
                      <button class="btn btn-link btn-sm p-0 ms-1 field-delete-btn-table" (click)="deleteField(dept, j)" title="Delete field" aria-label="Delete field">
                        <i class="bi bi-x-circle-fill"></i>
                      </button>
                    </span>
                  </div>
                </td>
                <td class="text-center">
                  <button class="btn btn-primary btn-sm rounded-pill modern-add-field-btn-table" (click)="openAddFieldModal(dept)">
                    <i class="bi bi-plus-circle me-1"></i> Add Field
                  </button>
                </td>
                <td class="pe-4">
                  <div class="dropdown">
                    <button class="btn btn-sm btn-light rounded-circle modern-dept-menu-btn-table" type="button" [id]="'deptMenu' + i" data-bs-toggle="dropdown" aria-expanded="false" title="Department options" aria-label="Department options">
                      <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow-sm" [attr.aria-labelledby]="'deptMenu' + i">
                      <li>
                        <a class="dropdown-item" href="javascript:void(0)" (click)="editDepartment(dept, getDepartmentIndex(dept))">
                          <i class="bi bi-pencil-square text-primary me-2"></i>Edit Department
                        </a>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <a class="dropdown-item text-danger" href="javascript:void(0)" (click)="deleteDepartment(dept, getDepartmentIndex(dept))">
                          <i class="bi bi-trash-fill me-2"></i>Delete Department
                        </a>
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== SUPERVISORS SECTION (With Filters & Pagination) ===================== -->
  <div *ngIf="activeSection === 'Supervisor'" class="supervisors-section">
    <!-- Section Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h4 class="fw-bold text-primary mb-3 mb-md-0">
        <i class="bi bi-person-badge-fill me-2"></i>Supervisors Management
      </h4>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm border-0 mb-4 leave-filters-card">
      <div class="card-body p-3 p-md-4">
        <div class="row g-3">
          <div class="col-12 col-sm-6 col-md-3">
            <label for="supervisorFilterName" class="form-label fw-medium mb-2">Name/Email</label>
            <input type="text" 
                   id="supervisorFilterName" 
                   class="form-control form-control-sm" 
                   placeholder="Search by name or email..." 
                   [(ngModel)]="supervisorSearch" 
                   (input)="supervisorCurrentPage=1" />
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="supervisorFilterDepartment" class="form-label fw-medium mb-2">Department</label>
            <select id="supervisorFilterDepartment" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="supervisorFilterDepartment" 
                    (change)="updateFilteredSupervisors(); supervisorCurrentPage=1" 
                    title="Select department">
              <option value="">All Departments</option>
              <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="supervisorFilterField" class="form-label fw-medium mb-2">Field</label>
            <select id="supervisorFilterField" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="supervisorFilterField" 
                    (change)="supervisorCurrentPage=1" 
                    title="Select field">
              <option value="">All Fields</option>
              <option *ngFor="let field of filteredFieldsForSupervisors" [value]="field">{{ field }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="supervisorFilterStatus" class="form-label fw-medium mb-2">Status</label>
            <select id="supervisorFilterStatus" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="supervisorFilterStatus" 
                    (change)="supervisorCurrentPage=1" 
                    title="Select status">
              <option value="">All Status</option>
              <option value="Active">Active</option>
              <option value="On Leave">On Leave</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="col-12 col-md-12 d-flex align-items-end">
            <button class="btn btn-outline-secondary" (click)="resetSupervisorFilters()">
              <i class="bi bi-arrow-repeat me-1"></i>Reset Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count & Page Size Selector -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
      <p class="text-muted mb-0 small">
        <i class="bi bi-info-circle me-1"></i>
        Showing {{ (supervisorCurrentPage - 1) * supervisorItemsPerPage + 1 }} - 
        {{ Math.min(supervisorCurrentPage * supervisorItemsPerPage, filteredSupervisors.length) }} 
        of {{ filteredSupervisors.length }} supervisors
        <span class="badge bg-info ms-2">Total: {{ activeSupervisorsCount }}</span>
      </p>
      <div class="d-flex align-items-center gap-2">
        <label for="supervisorPageSize" class="form-label mb-0 small text-muted">Items per page:</label>
        <select id="supervisorPageSize" 
                class="form-select form-select-sm page-size-selector" 
                [(ngModel)]="supervisorItemsPerPage" 
                (change)="supervisorCurrentPage = 1"
                title="Select items per page">
          <option [value]="10">10</option>
          <option [value]="25" selected>25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>

    <!-- Supervisors Table -->
    <div class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-3">Name</th>
                <th>Email</th>
                <th>Department</th>
                <th>Field</th>
                <th class="text-center">Assigned Interns</th>
                <th class="text-center">Status</th>
                <th class="text-center pe-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let supervisor of paginatedSupervisors; let i = index">
                <td class="ps-3 fw-semibold">{{ supervisor.name }}</td>
                <td><small class="text-muted">{{ supervisor.email }}</small></td>
                <td><span class="badge bg-secondary-subtle text-secondary">{{ supervisor.department }}</span></td>
                <td><small>{{ supervisor.field }}</small></td>
                <td class="text-center">
                  <span class="badge bg-info-subtle text-info">{{ supervisor.assignedInterns?.length || 0 }}</span>
                </td>
                <td class="text-center">
                  <span class="badge rounded-pill px-3 py-1"
                        [ngClass]="{
                          'bg-success': supervisor.status === 'Active' && supervisor.active !== false,
                          'bg-warning text-dark': supervisor.status === 'On Leave' && supervisor.active !== false,
                          'bg-danger': supervisor.status === 'Inactive' && supervisor.active !== false,
                          'bg-secondary': supervisor.active === false
                        }">
                    {{ supervisor.active === false ? 'Inactive' : supervisor.status }}
                  </span>
                </td>
                <td class="text-center pe-3">
                  <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary btn-sm rounded-start-pill" 
                            (click)="openEditSupervisorModal(supervisor)" 
                            title="Edit supervisor" 
                            aria-label="Edit supervisor"
                            [disabled]="supervisor.active === false">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button *ngIf="supervisor.active !== false" 
                            class="btn btn-outline-warning btn-sm rounded-end-pill" 
                            (click)="deactivateSupervisor(supervisor)" 
                            title="Deactivate supervisor" 
                            aria-label="Deactivate supervisor">
                      <i class="bi bi-power"></i>
                    </button>
                    <button *ngIf="supervisor.active === false" 
                            class="btn btn-outline-success btn-sm rounded-end-pill" 
                            (click)="deactivateSupervisor(supervisor)" 
                            title="Activate supervisor" 
                            aria-label="Activate supervisor">
                      <i class="bi bi-power"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredSupervisors.length === 0">
                <td colspan="7" class="text-center text-muted py-5">
                  <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                  <p class="mb-0">No supervisors found.</p>
                  <small class="text-muted d-block mt-2">Total supervisors: {{ activeSupervisorsCount }} | Filtered: {{ filteredSupervisors.length }}</small>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-4 gap-3">
      <div class="order-2 order-sm-1">
        <nav aria-label="Supervisors pagination">
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="supervisorCurrentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="prevSupervisorPage()" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li class="page-item" 
                *ngFor="let page of getSupervisorPageNumbers()" 
                [class.active]="page === supervisorCurrentPage"
                [class.disabled]="page === -1">
              <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToSupervisorPage(page)">{{ page }}</a>
              <span *ngIf="page === -1" class="page-link">...</span>
            </li>
            <li class="page-item" [class.disabled]="supervisorCurrentPage === totalSupervisorPages">
              <a class="page-link" href="javascript:void(0)" (click)="nextSupervisorPage()" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="order-1 order-sm-2 text-center text-sm-end">
        <small class="text-muted">
          Page <strong>{{ supervisorCurrentPage }}</strong> of <strong>{{ totalSupervisorPages }}</strong>
        </small>
      </div>
    </div>

  </div>


  <!-- ===================== INTERNS SECTION (With Filters & Pagination) ===================== -->
  <div *ngIf="activeSection === 'interns'" class="interns-section">
    <!-- Section Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h4 class="fw-bold text-primary mb-3 mb-md-0">
        <i class="bi bi-people-fill me-2"></i>Interns Management
      </h4>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm border-0 mb-4 leave-filters-card">
      <div class="card-body p-3 p-md-4">
        <div class="row g-3">
          <div class="col-12 col-sm-6 col-md-3">
            <label for="internFilterName" class="form-label fw-medium mb-2">Name/Email</label>
            <input type="text" 
                   id="internFilterName" 
                   class="form-control form-control-sm" 
                   placeholder="Search by name or email..." 
                   [(ngModel)]="internSearch" 
                   (input)="internCurrentPage=1" />
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="internFilterDepartment" class="form-label fw-medium mb-2">Department</label>
            <select id="internFilterDepartment" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="internFilterDepartment" 
                    (change)="updateFilteredInterns(); internCurrentPage=1" 
                    title="Select department">
              <option value="">All Departments</option>
              <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="internFilterField" class="form-label fw-medium mb-2">Field</label>
            <select id="internFilterField" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="internFilterField" 
                    (change)="internCurrentPage=1" 
                    title="Select field">
              <option value="">All Fields</option>
              <option *ngFor="let field of filteredFieldsForInterns" [value]="field">{{ field }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <label for="internFilterEmployer" class="form-label fw-medium mb-2">Employer</label>
            <select id="internFilterEmployer" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="internFilterEmployer" 
                    (change)="internCurrentPage=1" 
                    title="Select employer">
              <option value="">All Employers</option>
              <option *ngFor="let employer of employerList" [value]="employer">{{ employer }}</option>
            </select>
          </div>
                <div class="col-12 col-sm-6 col-md-3">
                  <label for="internFilterStatus" class="form-label fw-medium mb-2">Status</label>
                  <select id="internFilterStatus" 
                          class="form-select form-select-sm" 
                          [(ngModel)]="internFilterStatus" 
                          (change)="internCurrentPage=1" 
                          title="Select status">
                    <option value="">All Status</option>
                    <option value="Present">Present</option>
                    <option value="Absent">Absent</option>
                    <option value="On Leave">On Leave</option>
                    <option value="Inactive">Inactive</option>
                  </select>
                </div>
          <div class="col-12 col-md-12 d-flex align-items-end">
            <button class="btn btn-outline-secondary" (click)="resetInternFilters()">
              <i class="bi bi-arrow-repeat me-1"></i>Reset Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count & Page Size Selector -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
      <p class="text-muted mb-0 small">
        <i class="bi bi-info-circle me-1"></i>
        Showing {{ (internCurrentPage - 1) * internItemsPerPage + 1 }} - 
        {{ Math.min(internCurrentPage * internItemsPerPage, filteredInterns.length) }} 
        of {{ filteredInterns.length }} interns
        <span class="badge bg-info ms-2">Total: {{ activeInternsCount }}</span>
      </p>
      <div class="d-flex align-items-center gap-2">
        <label for="internPageSize" class="form-label mb-0 small text-muted">Items per page:</label>
        <select id="internPageSize" 
                class="form-select form-select-sm page-size-selector" 
                [(ngModel)]="internItemsPerPage" 
                (change)="internCurrentPage = 1"
                title="Select items per page">
          <option [value]="10">10</option>
          <option [value]="25" selected>25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>

    <!-- Interns Table -->
    <div class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-3">Name</th>
                <th>Email</th>
                <th>Supervisor</th>
                <th>Employer</th>
                <th>Department</th>
                <th>Field</th>
                <th class="text-center">Status</th>
                <th class="text-center pe-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let intern of paginatedInterns; let i = index">
                <td class="ps-3 fw-semibold">{{ intern.name }}</td>
                <td><small class="text-muted">{{ intern.email }}</small></td>
                <td>{{ intern.supervisor }}</td>
                <td><span class="badge bg-info-subtle text-info">{{ intern.employer || 'N/A' }}</span></td>
                <td><span class="badge bg-secondary-subtle text-secondary">{{ intern.department }}</span></td>
                <td><small>{{ intern.field }}</small></td>
                <td class="text-center">
                  <span class="badge rounded-pill px-3 py-1"
                        [ngClass]="{
                          'bg-success': intern.status === 'Present' && intern.active !== false,
                          'bg-warning text-dark': intern.status === 'On Leave' && intern.active !== false,
                          'bg-danger': intern.status === 'Absent' && intern.active !== false,
                          'bg-secondary': intern.active === false
                        }">
                    {{ intern.active === false ? 'Inactive' : intern.status }}
                  </span>
                </td>
                <td class="text-center pe-3">
                  <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary btn-sm rounded-start-pill" 
                            (click)="openEditModal(intern)" 
                            title="Edit intern" 
                            aria-label="Edit intern"
                            [disabled]="intern.active === false">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button *ngIf="intern.active !== false" 
                            class="btn btn-outline-warning btn-sm rounded-end-pill" 
                            (click)="deactivateIntern(intern)" 
                            title="Deactivate intern" 
                            aria-label="Deactivate intern">
                      <i class="bi bi-power"></i>
                    </button>
                    <button *ngIf="intern.active === false" 
                            class="btn btn-outline-success btn-sm rounded-end-pill" 
                            (click)="deactivateIntern(intern)" 
                            title="Activate intern" 
                            aria-label="Activate intern">
                      <i class="bi bi-power"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredInterns.length === 0">
                <td colspan="8" class="text-center text-muted py-5">
                  <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                  <p class="mb-0">No interns found.</p>
                  <small class="text-muted d-block mt-2">Total interns: {{ activeInternsCount }} | Filtered: {{ filteredInterns.length }}</small>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-4 gap-3">
      <div class="order-2 order-sm-1">
        <nav aria-label="Interns pagination">
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="internCurrentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="prevInternPage()" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li class="page-item" 
                *ngFor="let page of getInternPageNumbers()" 
                [class.active]="page === internCurrentPage"
                [class.disabled]="page === -1">
              <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToInternPage(page)">{{ page }}</a>
              <span *ngIf="page === -1" class="page-link">...</span>
            </li>
            <li class="page-item" [class.disabled]="internCurrentPage === totalInternPages">
              <a class="page-link" href="javascript:void(0)" (click)="nextInternPage()" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="order-1 order-sm-2 text-center text-sm-end">
        <small class="text-muted">
          Page <strong>{{ internCurrentPage }}</strong> of <strong>{{ totalInternPages }}</strong>
        </small>
      </div>
    </div>

  </div>


  <!-- ===================== LEAVE STATUS SECTION (Improved & Responsive) ===================== -->
  <div *ngIf="activeSection === 'Intern Leave status'" class="leave-status-section">
    <!-- Section Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h4 class="fw-bold text-primary mb-3 mb-md-0">
        <i class="bi bi-calendar-check me-2"></i>Intern Leave Requests
      </h4>
      <div class="d-flex gap-2 mb-3 mb-md-0">
        <div *ngIf="clearedLeaveRequests.length > 0">
          <button class="btn btn-warning rounded-5" (click)="undoClear()">
            <i class="bi bi-arrow-counterclockwise me-1"></i>Undo Cleared Requests
          </button>
        </div>
      </div>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm border-0 mb-4 leave-filters-card">
      <div class="card-body p-3 p-md-4">
        <div class="row g-3">
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <label for="leaveStatusFilterName" class="form-label fw-medium mb-2">Intern Name</label>
            <input type="text" 
                   id="leaveStatusFilterName" 
                   class="form-control form-control-sm" 
                   placeholder="Search by name..." 
                   [(ngModel)]="leaveFilterName" 
                   (input)="leaveCurrentPage=1" />
          </div>
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <label for="leaveStatusFilterDepartment" class="form-label fw-medium mb-2">Department</label>
            <select id="leaveStatusFilterDepartment" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="leaveFilterDepartment" 
                    (change)="updateLeaveFields(); leaveCurrentPage=1" 
                    title="Select department">
              <option value="">All Departments</option>
              <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <label for="leaveStatusFilterField" class="form-label fw-medium mb-2">Field</label>
            <select id="leaveStatusFilterField" 
                    class="form-select form-select-sm" 
                    [(ngModel)]="leaveFilterField" 
                    (change)="leaveCurrentPage=1" 
                    title="Select field">
              <option value="">All Fields</option>
              <option *ngFor="let field of filteredLeaveFields" [value]="field">{{ field }}</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-12 col-lg-3 d-flex align-items-end">
            <button class="btn btn-outline-secondary w-100" (click)="resetLeaveFilters()">
              <i class="bi bi-arrow-repeat me-1"></i>Reset Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count & Page Size Selector -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
      <p class="text-muted mb-0 small">
        <i class="bi bi-info-circle me-1"></i>
        Showing {{ (leaveCurrentPage - 1) * leaveItemsPerPage + 1 }} - 
        {{ Math.min(leaveCurrentPage * leaveItemsPerPage, filteredLeaveRequests.length) }} 
        of {{ filteredLeaveRequests.length }} leave requests
        <span class="badge bg-info ms-2">Total: {{ leaveRequests.length }}</span>
      </p>
      <div class="d-flex align-items-center gap-2">
        <label for="leavePageSize" class="form-label mb-0 small text-muted">Items per page:</label>
        <select id="leavePageSize" 
                class="form-select form-select-sm page-size-selector" 
                [(ngModel)]="leaveItemsPerPage" 
                (change)="leaveCurrentPage = 1"
                title="Select items per page">
          <option [value]="10">10</option>
          <option [value]="25" selected>25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>

    <!-- Desktop Table View (hidden on mobile) -->
    <div class="d-none d-lg-block">
      <div class="card shadow-sm border-0 leave-table-card">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 leave-requests-table">
              <thead class="table-light">
                <tr>
                  <th class="ps-3">Intern</th>
                  <th>Email</th>
                  <th>Department</th>
                  <th>Field</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Reason</th>
                  <th class="text-center">Status</th>
                  <th class="text-center">Documents</th>
                  <th class="text-center pe-3">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let request of paginatedLeaveRequests; let i = index" class="leave-request-row">
                  <td class="ps-3 fw-semibold">{{ request.name }}</td>
                  <td><small class="text-muted">{{ request.email }}</small></td>
                  <td><span class="badge bg-secondary-subtle text-secondary">{{ request.department }}</span></td>
                  <td><small>{{ request.field }}</small></td>
                  <td><small>{{ request.startDate }}</small></td>
                  <td><small>{{ request.endDate }}</small></td>
                  <td><small class="text-truncate d-inline-block reason-text" [title]="request.reason">{{ request.reason }}</small></td>
                  <td class="text-center">
                    <span class="badge rounded-pill px-3 py-1"
                          [ngClass]="{
                            'bg-success': request.status === 'Approved',
                            'bg-warning text-dark': request.status === 'Pending',
                            'bg-danger': request.status === 'Declined'
                          }">{{ request.status }}</span>
                  </td>
                  <td class="text-center">
                    <a *ngIf="request.document" 
                       [href]="request.document" 
                       target="_blank" 
                       class="btn btn-info btn-sm rounded-pill"
                       title="View document">
                      <i class="bi bi-paperclip"></i>
                    </a>
                    <span *ngIf="!request.document" class="text-muted">-</span>
                  </td>
                  <td class="text-center pe-3">
                    <div class="btn-group" role="group">
                      <button class="btn btn-success btn-sm rounded-start-pill" 
                              (click)="approveRequest(request)"
                              title="Approve request">
                        <i class="bi bi-check-circle"></i>
                      </button>
                      <button class="btn btn-danger btn-sm rounded-0" 
                              (click)="declineRequest(request)"
                              title="Decline request">
                        <i class="bi bi-x-circle"></i>
                      </button>
                      <button class="btn btn-outline-secondary btn-sm rounded-end-pill" 
                              (click)="clearLeaveRequestByRequest(request)"
                              title="Clear request">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="filteredLeaveRequests.length === 0 && paginatedLeaveRequests.length === 0">
                  <td colspan="10" class="text-center text-muted py-5">
                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                    <p class="mb-0">No leave requests found.</p>
                    <small class="text-muted d-block mt-2">Total requests: {{ leaveRequests.length }} | Filtered: {{ filteredLeaveRequests.length }}</small>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile/Tablet Card View (visible on smaller screens) -->
    <div class="d-block d-lg-none">
      <div *ngFor="let request of paginatedLeaveRequests; let i = index" class="mb-3">
        <div class="card shadow-sm border-0 leave-request-card">
          <div class="card-body p-3">
            <!-- Header with Name and Status -->
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="flex-grow-1">
                <h6 class="fw-bold mb-1">{{ request.name }}</h6>
                <small class="text-muted d-block">{{ request.email }}</small>
              </div>
              <span class="badge rounded-pill px-3 py-2"
                  [ngClass]="{
                    'bg-success': request.status === 'Approved',
                    'bg-warning text-dark': request.status === 'Pending',
                    'bg-danger': request.status === 'Declined'
                  }">{{ request.status }}</span>
            </div>

            <!-- Details Grid -->
            <div class="row g-2 mb-3">
              <div class="col-6">
                <small class="text-muted d-block">Department</small>
                <span class="badge bg-secondary-subtle text-secondary">{{ request.department }}</span>
              </div>
              <div class="col-6">
                <small class="text-muted d-block">Field</small>
                <small class="fw-medium">{{ request.field }}</small>
              </div>
              <div class="col-6">
                <small class="text-muted d-block">Start Date</small>
                <small class="fw-medium">{{ request.startDate }}</small>
              </div>
              <div class="col-6">
                <small class="text-muted d-block">End Date</small>
                <small class="fw-medium">{{ request.endDate }}</small>
              </div>
              <div class="col-12">
                <small class="text-muted d-block mb-1">Reason</small>
                <p class="mb-0 small">{{ request.reason }}</p>
              </div>
            </div>

            <!-- Document Link -->
            <div *ngIf="request.document" class="mb-3">
              <a [href]="request.document" 
                 target="_blank" 
                 class="btn btn-info btn-sm w-100 rounded-pill">
                <i class="bi bi-paperclip me-1"></i>View Document
              </a>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-2">
              <div class="btn-group w-100" role="group">
                <button class="btn btn-success btn-sm flex-fill" 
                        (click)="approveRequest(request)">
                  <i class="bi bi-check-circle me-1"></i>Approve
                </button>
                <button class="btn btn-danger btn-sm flex-fill" 
                        (click)="declineRequest(request)">
                  <i class="bi bi-x-circle me-1"></i>Decline
                </button>
              </div>
              <button class="btn btn-outline-secondary btn-sm w-100" 
                      (click)="clearLeaveRequestByRequest(request)">
                <i class="bi bi-trash me-1"></i>Clear
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State for Mobile -->
      <div *ngIf="filteredLeaveRequests.length === 0" class="card shadow-sm border-0">
        <div class="card-body text-center py-5">
          <i class="bi bi-inbox fs-1 text-muted d-block mb-3"></i>
          <p class="text-muted mb-0">No leave requests found.</p>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-4 gap-3">
      <div class="order-2 order-sm-1">
        <nav aria-label="Leave requests pagination">
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="leaveCurrentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="prevLeavePage()" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li class="page-item" 
                *ngFor="let page of getLeavePageNumbers()" 
                [class.active]="page === leaveCurrentPage"
                [class.disabled]="page === -1">
              <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToLeavePage(page)">{{ page }}</a>
              <span *ngIf="page === -1" class="page-link">...</span>
            </li>
            <li class="page-item" [class.disabled]="leaveCurrentPage === totalLeavePages">
              <a class="page-link" href="javascript:void(0)" (click)="nextLeavePage()" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="order-1 order-sm-2 text-center text-sm-end">
        <small class="text-muted">
          Page <strong>{{ leaveCurrentPage }}</strong> of <strong>{{ totalLeavePages }}</strong>
        </small>
      </div>
    </div>

  </div>

  <!-- ===================== ATTENDANCE HISTORY SECTION ===================== -->
  <div *ngIf="activeSection === 'Attendance history'">
    <!-- Section Header -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 overview-header-card">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <h3 class="fw-bold text-primary mb-2">
              <i class="bi bi-clock-history me-2"></i>Attendance History
            </h3>
            <p class="text-muted mb-0">View weekly attendance records and track intern attendance patterns over time.</p>
          </div>
          <div class="col-12 col-md-4 text-end mt-3 mt-md-0">
            <span class="badge bg-info text-white px-3 py-2 fs-6" *ngIf="internsForWeek.length > 0">
              <i class="bi bi-calendar-week me-1"></i>{{ internsForWeek.length }} Intern{{ internsForWeek.length !== 1 ? 's' : '' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Week Selector -->
    <div class="card shadow-sm border-0 mb-4 rounded-4" *ngIf="!historyFilterMonday || !historyFilterFriday">
      <div class="card-body p-3">
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <span class="fw-medium text-muted">Quick Select:</span>
          <button class="btn btn-outline-primary btn-sm" (click)="selectCurrentWeek()" title="Select current week">
            <i class="bi bi-calendar3 me-1"></i>This Week
          </button>
          <button class="btn btn-outline-primary btn-sm" (click)="selectLastWeek()" title="Select last week">
            <i class="bi bi-calendar3-week me-1"></i>Last Week
          </button>
          <button class="btn btn-outline-primary btn-sm" (click)="selectPreviousWeek()" title="Select previous week">
            <i class="bi bi-calendar3-range me-1"></i>2 Weeks Ago
          </button>
        </div>
        </div>
        </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4" *ngIf="internsForWeek.length > 0">
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-primary fs-3 mb-2">
              <i class="bi bi-people-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Total Interns</h6>
            <p class="fs-4 fw-bold mb-0 text-primary">{{ internsForWeek.length }}</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-success fs-3 mb-2">
              <i class="bi bi-check-circle-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Present Days</h6>
            <p class="fs-4 fw-bold mb-0 text-success">{{ getTotalPresentDays() }}</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-warning fs-3 mb-2">
              <i class="bi bi-calendar-check"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">On Leave</h6>
            <p class="fs-4 fw-bold mb-0 text-warning">{{ getTotalLeaveDays() }}</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-danger fs-3 mb-2">
              <i class="bi bi-x-circle-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Absent Days</h6>
            <p class="fs-4 fw-bold mb-0 text-danger">{{ getTotalAbsentDays() }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 report-filters-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <h5 class="text-primary fw-bold mb-3">
          <i class="bi bi-funnel me-2"></i>Week & Filters
        </h5>
      </div>
      <div class="card-body p-4">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-6 col-lg-3">
            <label for="historyMondayDate" class="form-label fw-medium mb-2">
              <i class="bi bi-calendar-event me-1"></i>Monday Date
            </label>
            <input type="date" 
                   id="historyMondayDate" 
                   class="form-control" 
                   [(ngModel)]="historyFilterMonday" 
                   (change)="onHistoryDateChange()"
                   placeholder="Select Monday date">
          </div>
          <div class="col-12 col-md-6 col-lg-3">
            <label for="historyFridayDate" class="form-label fw-medium mb-2">
              <i class="bi bi-calendar-event me-1"></i>Friday Date
            </label>
            <input type="date" 
                   id="historyFridayDate" 
                   class="form-control" 
                   [(ngModel)]="historyFilterFriday" 
                   (change)="onHistoryDateChange()"
                   placeholder="Select Friday date">
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="historyInternName" class="form-label fw-medium mb-2">Intern Name</label>
            <input type="text" 
                   id="historyInternName" 
                   class="form-control" 
                   [(ngModel)]="historyFilterName" 
                   (input)="onHistoryFilterChange()"
                   placeholder="Search by name...">
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="historyDepartment" class="form-label fw-medium mb-2">Department</label>
            <select id="historyDepartment" 
                    class="form-select" 
                    [(ngModel)]="historyFilterDepartment" 
                    (change)="updateHistoryFields(); onHistoryFilterChange()" 
                    title="Select department">
              <option value="">All Departments</option>
            <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
          </select>
        </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="historyField" class="form-label fw-medium mb-2">Field</label>
            <select id="historyField" 
                    class="form-select" 
                    [(ngModel)]="historyFilterField" 
                    (change)="onHistoryFilterChange()"
                    title="Select field">
              <option value="">All Fields</option>
            <option *ngFor="let field of filteredFieldsForHistory" [value]="field">{{ field }}</option>
          </select>
        </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="historyFilterStatus" class="form-label fw-medium mb-2">Status</label>
            <select id="historyFilterStatus" 
                    class="form-select" 
                    [(ngModel)]="historyFilterStatus" 
                    (change)="onHistoryFilterChange()"
                    title="Select status">
              <option value="">All Status</option>
              <option value="Present">Present</option>
              <option value="Absent">Absent</option>
              <option value="On Leave">On Leave</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
      </div>

        <!-- Date Range Display & Warning -->
        <div class="mt-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div *ngIf="historyFilterMonday && historyFilterFriday">
            <small class="text-muted">
              <i class="bi bi-calendar-range me-1"></i>
              Week: <strong>{{ historyFilterMonday | date:'shortDate' }}</strong> to <strong>{{ historyFilterFriday | date:'shortDate' }}</strong>
            </small>
      </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm" (click)="resetHistoryFilter()" title="Reset filters">
          <i class="bi bi-arrow-repeat me-1"></i> Reset
        </button>
          </div>
      </div>

        <div *ngIf="weekendSelected" class="alert alert-warning mt-3 mb-0">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Invalid Date Selection:</strong> Please ensure you select a Monday for the start date and a Friday for the end date.
        </div>
      </div>
    </div>

    <!-- Results Card -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 report-results-card" *ngIf="internsForWeek.length > 0">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-table me-2"></i>Weekly Attendance Register
            </h5>
            <p class="text-muted small mb-0">
              Showing <strong>{{ (historyCurrentPage - 1) * historyItemsPerPage + 1 }}</strong> - 
              <strong>{{ Math.min(historyCurrentPage * historyItemsPerPage, internsForWeek.length) }}</strong> 
              of <strong>{{ internsForWeek.length }}</strong> intern{{ internsForWeek.length !== 1 ? 's' : '' }}
              <span *ngIf="historyFilterMonday && historyFilterFriday">
                from {{ historyFilterMonday | date:'shortDate' }} to {{ historyFilterFriday | date:'shortDate' }}
              </span>
            </p>
          </div>
          <div class="mt-2 mt-md-0 d-flex align-items-center gap-2">
            <label for="historyPageSize" class="form-label mb-0 small text-muted">Items per page:</label>
            <select id="historyPageSize" 
                    class="form-select form-select-sm page-size-selector" 
                    [(ngModel)]="historyItemsPerPage" 
                    (change)="historyCurrentPage = 1"
                    title="Select items per page">
              <option [value]="5">5</option>
              <option [value]="10" selected>10</option>
              <option [value]="15">15</option>
              <option [value]="25">25</option>
              <option [value]="50">50</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
      <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle mb-0 history-table">
          <thead class="table-light">
          <tr>
              <th class="ps-4 history-intern-column">Intern</th>
              <th class="text-center" *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']">
                <div class="d-flex flex-column align-items-center">
                  <span class="fw-bold">{{ day }}</span>
                  <small class="text-muted" *ngIf="historyFilterMonday">
                    {{ getDayDate(day) | date:'MMM d' }}
                  </small>
                </div>
              </th>
          </tr>
          </thead>
          <tbody>
            <tr *ngFor="let intern of paginatedInternsForWeek">
              <td class="ps-4">
                <div class="d-flex align-items-center">
                  <div class="avatar-circle me-2">
                    <span class="avatar-text">{{ intern.name.charAt(0) }}</span>
                  </div>
                  <div>
                    <div class="fw-semibold">{{ intern.name }}</div>
                    <small class="text-muted d-block">Attendance Record</small>
                  </div>
                </div>
              </td>
              <td *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']" class="text-center">
                <div class="d-flex flex-column align-items-center gap-2 p-2">
                  <span class="badge rounded-pill px-3 py-2"
                    [ngClass]="{
                      'bg-success': intern.recordsByDay[day].action === 'Signed In',
                      'bg-danger': intern.recordsByDay[day].action === 'Signed Out',
                      'bg-warning text-dark': intern.recordsByDay[day].action === 'On Leave',
                      'bg-secondary': intern.recordsByDay[day].action === 'Absent'
                    }">
                    <i class="bi me-1" 
                       [class.bi-check-circle]="intern.recordsByDay[day].action === 'Signed In'"
                       [class.bi-x-circle]="intern.recordsByDay[day].action === 'Signed Out'"
                       [class.bi-calendar-check]="intern.recordsByDay[day].action === 'On Leave'"
                       [class.bi-dash-circle]="intern.recordsByDay[day].action === 'Absent'"></i>
                {{ intern.recordsByDay[day].action }}
              </span>
                  <div class="small text-muted" *ngIf="intern.recordsByDay[day].timeIn || intern.recordsByDay[day].timeOut">
                    <div *ngIf="intern.recordsByDay[day].timeIn">
                      <i class="bi bi-clock"></i> {{ intern.recordsByDay[day].timeIn | date:'HH:mm' }}
                    </div>
                    <div *ngIf="intern.recordsByDay[day].timeOut">
                      <i class="bi bi-clock-history"></i> {{ intern.recordsByDay[day].timeOut | date:'HH:mm' }}
                    </div>
                    <div *ngIf="!intern.recordsByDay[day].timeIn && !intern.recordsByDay[day].timeOut" class="text-muted">
                      -
                    </div>
                  </div>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        </div>
      </div>
      
      <!-- Pagination -->
      <div class="card-footer bg-white border-0 pt-3 pb-4 px-4" *ngIf="totalHistoryPages > 1">
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center gap-3">
          <div class="order-2 order-sm-1">
            <nav aria-label="History pagination">
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="historyCurrentPage === 1">
                  <a class="page-link" href="javascript:void(0)" (click)="prevHistoryPage()" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                <li class="page-item" 
                    *ngFor="let page of getHistoryPageNumbers()" 
                    [class.active]="page === historyCurrentPage"
                    [class.disabled]="page === -1">
                  <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToHistoryPage(page)">{{ page }}</a>
                  <span *ngIf="page === -1" class="page-link">...</span>
                </li>
                <li class="page-item" [class.disabled]="historyCurrentPage === totalHistoryPages">
                  <a class="page-link" href="javascript:void(0)" (click)="nextHistoryPage()" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
          <div class="order-1 order-sm-2 text-center text-sm-end">
            <small class="text-muted">
              Page <strong>{{ historyCurrentPage }}</strong> of <strong>{{ totalHistoryPages }}</strong>
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="card shadow-sm border-0 rounded-4" *ngIf="internsForWeek.length === 0 && !historyFilterMonday && !historyFilterFriday">
      <div class="card-body text-center py-5">
        <div class="mb-4">
          <i class="bi bi-calendar-week report-empty-icon"></i>
        </div>
        <h5 class="fw-bold text-muted mb-2">No Week Selected</h5>
        <p class="text-muted mb-4">Select a Monday and Friday date to view weekly attendance history, or use the quick select buttons above.</p>
      </div>
    </div>

    <!-- No Results State -->
    <div class="card shadow-sm border-0 rounded-4" *ngIf="internsForWeek.length === 0 && (historyFilterMonday || historyFilterFriday)">
      <div class="card-body text-center py-5">
        <div class="mb-4">
          <i class="bi bi-inbox report-empty-icon"></i>
        </div>
        <h5 class="fw-bold text-muted mb-2">No Attendance Data Found</h5>
        <p class="text-muted mb-4" *ngIf="!weekendSelected">
          No attendance records found for the selected week and filters. Try adjusting your search criteria or select a different week.
        </p>
        <button class="btn btn-outline-primary" (click)="resetHistoryFilter()">
          <i class="bi bi-arrow-repeat me-1"></i> Reset Filters
        </button>
      </div>
    </div>
  </div>

  <!-- ===================== REPORTS SECTION ===================== -->
  <div *ngIf="activeSection === 'reports'">
    <!-- Section Header -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 overview-header-card">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <h3 class="fw-bold text-primary mb-2">
              <i class="bi bi-file-earmark-text me-2"></i>Attendance Reports
            </h3>
            <p class="text-muted mb-0">Generate comprehensive attendance reports for your interns with advanced filtering options.</p>
        </div>
          <div class="col-12 col-md-4 text-end mt-3 mt-md-0">
            <span class="badge bg-info text-white px-3 py-2 fs-6" *ngIf="lastReportGenerated">
              <i class="bi bi-clock-history me-1"></i>Last Generated: {{ lastReportGenerated | date:'short' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Statistics Cards -->
    <div class="row g-3 mb-4" *ngIf="filteredReportData.length > 0">
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-primary fs-3 mb-2">
              <i class="bi bi-people-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Total Records</h6>
            <p class="fs-4 fw-bold mb-0 text-primary">{{ filteredReportData.length }}</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-success fs-3 mb-2">
              <i class="bi bi-check-circle-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Avg Attendance</h6>
            <p class="fs-4 fw-bold mb-0 text-success">{{ getAverageAttendance() }}%</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-warning fs-3 mb-2">
              <i class="bi bi-calendar-check"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Total Present</h6>
            <p class="fs-4 fw-bold mb-0 text-warning">{{ getTotalPresent() }}</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center py-3 h-100 report-stat-card">
          <div class="card-body">
            <div class="text-danger fs-3 mb-2">
              <i class="bi bi-x-circle-fill"></i>
            </div>
            <h6 class="fw-semibold text-muted mb-1 small">Total Absent</h6>
            <p class="fs-4 fw-bold mb-0 text-danger">{{ getTotalAbsent() }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 report-filters-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <h5 class="text-primary fw-bold mb-3">
          <i class="bi bi-funnel me-2"></i>Report Filters
        </h5>
      </div>
      <div class="card-body p-4">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-6 col-lg-3">
            <label for="reportInternName" class="form-label fw-medium mb-2">Intern Name</label>
            <input type="text" 
                   id="reportInternName" 
                   class="form-control" 
                   [(ngModel)]="reportInternName" 
                   placeholder="Search by name..."
                   (input)="generateReport()">
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="reportDepartment" class="form-label fw-medium mb-2">Department</label>
            <select id="reportDepartment" 
                    class="form-select" 
                    [(ngModel)]="reportDepartment" 
                    (change)="updateReportFields(); generateReport()" 
                    title="Select department">
              <option value="">All Departments</option>
            <option *ngFor="let dept of departmentList" [value]="dept">{{ dept }}</option>
          </select>
        </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="reportField" class="form-label fw-medium mb-2">Field</label>
            <select id="reportField" 
                    class="form-select" 
                    [(ngModel)]="reportField" 
                    (change)="generateReport()"
                    title="Select field">
              <option value="">All Fields</option>
            <option *ngFor="let field of filteredFieldsForReport" [value]="field">{{ field }}</option>
          </select>
        </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="reportFilterStatus" class="form-label fw-medium mb-2">Status</label>
            <select id="reportFilterStatus" 
                    class="form-select" 
                    [(ngModel)]="reportFilterStatus" 
                    (change)="generateReport()" 
                    title="Select status">
              <option value="">All Status</option>
              <option value="Present">Present</option>
              <option value="Absent">Absent</option>
              <option value="On Leave">On Leave</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="reportFromDate" class="form-label fw-medium mb-2">From Date</label>
            <input type="date" 
                   id="reportFromDate" 
                   class="form-control" 
                   [(ngModel)]="reportFromDate" 
                   (change)="generateReport()"
                   placeholder="Select from date">
        </div>
          <div class="col-12 col-md-6 col-lg-2">
            <label for="reportToDate" class="form-label fw-medium mb-2">To Date</label>
            <input type="date" 
                   id="reportToDate" 
                   class="form-control" 
                   [(ngModel)]="reportToDate" 
                   (change)="generateReport()"
                   placeholder="Select to date">
        </div>
          <div class="col-12 col-md-6 col-lg-1 d-flex align-items-end gap-2">
            <button class="btn btn-outline-secondary btn-sm w-100" (click)="resetReportFilter()" title="Reset filters">
              <i class="bi bi-arrow-repeat"></i>
            </button>
      </div>
        </div>
        
        <!-- Date Range Display -->
        <div class="mt-3" *ngIf="reportFromDate || reportToDate">
          <small class="text-muted">
            <i class="bi bi-calendar-range me-1"></i>
            Date Range: 
            <strong>{{ reportFromDate || 'Start' }}</strong> to <strong>{{ reportToDate || 'End' }}</strong>
          </small>
        </div>
      </div>
    </div>

    <!-- Results Card -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 report-results-card" *ngIf="filteredReportData.length > 0 || lastReportGenerated">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-table me-2"></i>Report Results
            </h5>
            <p class="text-muted small mb-0">
              Showing <strong>{{ filteredReportData.length }}</strong> record{{ filteredReportData.length !== 1 ? 's' : '' }}
              <span *ngIf="reportFromDate || reportToDate">for the selected date range</span>
            </p>
          </div>
          <div class="mt-2 mt-md-0 d-flex gap-2">
            <button class="btn btn-danger btn-sm" (click)="downloadReportPDF()" title="Export to PDF">
              <i class="bi bi-file-earmark-pdf me-1"></i> PDF
        </button>
            <button class="btn btn-success btn-sm" (click)="downloadReportExcel()" title="Export to Excel">
              <i class="bi bi-file-earmark-excel me-1"></i> Excel
        </button>
          </div>
        </div>
      </div>

      <div class="card-body p-0">
      <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 report-table">
          <thead class="table-light">
          <tr>
              <th class="ps-4">Intern</th>
            <th>Department</th>
            <th>Field</th>
              <th class="text-center">
                <i class="bi bi-check-circle text-success me-1"></i>Present
              </th>
              <th class="text-center">
                <i class="bi bi-x-circle text-danger me-1"></i>Absent
              </th>
              <th class="text-center">
                <i class="bi bi-calendar-check text-warning me-1"></i>Leave
              </th>
              <th class="text-center">
                <i class="bi bi-percent me-1"></i>Attendance %
              </th>
              <th class="text-center pe-4">Last Active</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let record of paginatedReportData">
              <td class="ps-4">
                <div class="d-flex align-items-center">
                  <div class="avatar-circle me-2">
                    <span class="avatar-text">{{ record.name.charAt(0) }}</span>
                  </div>
                  <div class="fw-semibold">{{ record.name }}</div>
                </div>
              </td>
              <td>
                <span class="badge bg-secondary-subtle text-secondary">{{ record.department }}</span>
              </td>
              <td><small class="text-muted">{{ record.field }}</small></td>
              <td class="text-center">
                <span class="badge bg-success-subtle text-success fw-semibold">{{ record.present }}</span>
              </td>
              <td class="text-center">
                <span class="badge bg-danger-subtle text-danger fw-semibold">{{ record.absent }}</span>
              </td>
              <td class="text-center">
                <span class="badge bg-warning-subtle text-warning fw-semibold">{{ record.leave }}</span>
              </td>
              <td class="text-center">
                <div class="d-flex align-items-center justify-content-center gap-2">
                  <div class="progress flex-grow-1 report-progress-bar">
                    <div class="progress-bar" 
                         [class.bg-success]="record.attendanceRate >= 80"
                         [class.bg-warning]="record.attendanceRate >= 50 && record.attendanceRate < 80"
                         [class.bg-danger]="record.attendanceRate < 50"
                         [style.width.%]="record.attendanceRate">
                    </div>
                  </div>
                  <span class="badge report-attendance-badge" 
                        [class.bg-success]="record.attendanceRate >= 80"
                        [class.bg-warning]="record.attendanceRate >= 50 && record.attendanceRate < 80"
                        [class.bg-danger]="record.attendanceRate < 50">{{ record.attendanceRate }}%</span>
                </div>
              </td>
              <td class="text-center pe-4">
                <small class="text-muted">{{ record.lastActive ? (record.lastActive | date:'short') : 'N/A' }}</small>
              </td>
          </tr>
          </tbody>
        </table>
            </div>
      </div>

          <!-- Pagination -->
          <div class="card-footer bg-white border-0 pt-3 pb-4 px-4" *ngIf="totalReportPages > 1">
            <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center gap-3">
              <div class="order-2 order-sm-1">
                <nav aria-label="Report pagination">
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="reportCurrentPage === 1">
                      <a class="page-link" href="javascript:void(0)" (click)="prevReportPage()" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                      </a>
                    </li>
                    <li class="page-item" 
                        *ngFor="let page of getReportPageNumbers()" 
                        [class.active]="page === reportCurrentPage"
                        [class.disabled]="page === -1">
                      <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToReportPage(page)">{{ page }}</a>
                      <span *ngIf="page === -1" class="page-link">...</span>
                    </li>
                    <li class="page-item" [class.disabled]="reportCurrentPage === totalReportPages">
                      <a class="page-link" href="javascript:void(0)" (click)="nextReportPage()" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
              <div class="order-1 order-sm-2 text-center text-sm-end">
                <small class="text-muted">
                  Page <strong>{{ reportCurrentPage }}</strong> of <strong>{{ totalReportPages }}</strong>
                </small>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
    <div class="card shadow-sm border-0 rounded-4" *ngIf="filteredReportData.length === 0 && !lastReportGenerated">
      <div class="card-body text-center py-5">
        <div class="mb-4">
          <i class="bi bi-file-earmark-text report-empty-icon"></i>
        </div>
        <h5 class="fw-bold text-muted mb-2">No Report Generated</h5>
        <p class="text-muted mb-4">Use the filters above to generate an attendance report for your interns.</p>
        <button class="btn btn-primary" (click)="generateReport()">
          <i class="bi bi-search me-1"></i> Generate Report
        </button>
      </div>
    </div>

    <!-- No Results State -->
    <div class="card shadow-sm border-0 rounded-4" *ngIf="filteredReportData.length === 0 && lastReportGenerated">
      <div class="card-body text-center py-5">
        <div class="mb-4">
          <i class="bi bi-inbox report-empty-icon"></i>
        </div>
        <h5 class="fw-bold text-muted mb-2">No Results Found</h5>
        <p class="text-muted mb-4">No records match the selected filters. Try adjusting your search criteria.</p>
        <button class="btn btn-outline-primary" (click)="resetReportFilter()">
          <i class="bi bi-arrow-repeat me-1"></i> Reset Filters
        </button>
      </div>
    </div>
  </div>

  <!-- ===================== LOCATIONS SECTION ===================== -->
  <div *ngIf="activeSection === 'Locations'" class="locations-section">
    <!-- Section Header -->
    <div class="card shadow-lg border-0 rounded-4 mb-4">
      <div class="card-header bg-gradient-primary text-white border-0 rounded-top-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h4 class="fw-bold mb-1">
              <i class="bi bi-geo-alt-fill me-2"></i>Manage Sign-in Locations
            </h4>
            <p class="mb-0 small opacity-75">Click on the map to add new locations where interns can sign in</p>
          </div>
          <span class="badge bg-light text-primary px-3 py-2">
            {{ locations.length }} Location{{ locations.length !== 1 ? 's' : '' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Map and Locations List -->
    <div class="row g-4">
      <!-- Map Column -->
      <div class="col-12 col-lg-8">
        <div class="card shadow-lg border-0 rounded-4 h-100">
          <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
            <h5 class="fw-bold text-primary mb-3">
              <i class="bi bi-map me-2"></i>University of Venda Campus Map
            </h5>
            <div class="alert alert-info mb-0">
              <i class="bi bi-info-circle me-2"></i>
              <strong>Instructions:</strong> Click anywhere on the map to add a new sign-in location. Each location will have a radius (in meters) where interns can sign in.
            </div>
            <div class="alert alert-success mt-2 mb-0">
              <i class="bi bi-check-circle me-2"></i>
              <strong>OpenStreetMap:</strong> This map uses free OpenStreetMap data - no API key required!
            </div>
            <div class="alert alert-warning mt-2 mb-0" *ngIf="!isMapReady">
              <i class="bi bi-hourglass-split me-2"></i>
              <strong>Loading map...</strong> Please wait while the map loads.
            </div>
          </div>
          <div class="card-body p-0">
            <div id="locations-map" class="locations-map-container" [style.min-height.px]="isMapReady ? 600 : 400">
              <div *ngIf="!isMapReady" class="d-flex align-items-center justify-content-center h-100">
                <div class="text-center">
                  <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="text-muted">Loading OpenStreetMap...</p>
                  <small class="text-muted">This map uses free OpenStreetMap data.</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Locations List Column -->
      <div class="col-12 col-lg-4">
        <div class="card shadow-lg border-0 rounded-4 h-100">
          <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
            <h5 class="fw-bold text-primary mb-0">
              <i class="bi bi-list-ul me-2"></i>Saved Locations
            </h5>
          </div>
          <div class="card-body p-4">
            <!-- Empty State -->
            <div *ngIf="locations.length === 0" class="text-center py-5">
              <i class="bi bi-geo-alt locations-empty-icon"></i>
              <p class="text-muted mt-3 mb-0">No locations added yet</p>
              <p class="text-muted small">Click on the map to add your first location</p>
            </div>

            <!-- Locations List -->
            <div *ngIf="locations.length > 0" class="locations-list">
              <div *ngFor="let location of locations" class="location-item mb-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div class="flex-grow-1">
                    <h6 class="fw-bold text-dark mb-1">
                      <i class="bi bi-geo-alt-fill text-primary me-2"></i>{{ location.name }}
                    </h6>
                    <p class="text-muted small mb-1" *ngIf="location.description">{{ location.description }}</p>
                    <div class="d-flex flex-wrap gap-2">
                      <span class="badge bg-info-subtle text-info">
                        <i class="bi bi-rulers me-1"></i>{{ location.radius }}m radius
                      </span>
                      <span class="badge bg-secondary-subtle text-secondary">
                        <i class="bi bi-geo me-1"></i>{{ location.latitude.toFixed(4) }}, {{ location.longitude.toFixed(4) }}
                      </span>
                    </div>
                  </div>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-primary flex-grow-1" (click)="editLocation(location)" title="Edit location">
                    <i class="bi bi-pencil-fill me-1"></i> Edit
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteLocation(location)" title="Delete location">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
  </main>
</div>


