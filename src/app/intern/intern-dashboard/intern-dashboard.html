<!-- ==================== INTERN DASHBOARD ==================== -->
<app-navbar></app-navbar>

<div class="dashboard-wrapper pt-5">
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" [class.collapsed]="!isSidebarExpanded">
    <!-- User Profile Section -->
    <div class="sidebar-header pt-4">
      <div class="user-profile" *ngIf="isSidebarExpanded">
        <i class="bi bi-person-circle profile-image"></i>
        <div class="user-info">
          <h6 class="user-name">Welcome {{ intern.name }}</h6>
          <p class="user-email">{{ intern.email }}</p>
          <div class="user-meta mt-2">
            <span class="badge bg-danger-subtle text-danger me-1 mb-1" *ngIf="intern?.role">
              {{ intern.role }}
            </span>
            <span class="badge bg-primary-subtle text-primary me-1 mb-1" *ngIf="intern?.Department">
              {{ intern.Department }}
            </span>
            <span class="badge bg-info-subtle text-info me-1 mb-1" *ngIf="intern?.field">
              {{ intern.field }}
            </span>
          </div>
        </div>
      </div>
      <div class="user-profile-collapsed" *ngIf="!isSidebarExpanded">
        <i class="bi bi-person-circle profile-image-small"></i>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="sidebar-nav">
      <ul class="nav-menu">
        <li *ngFor="let item of navItems" 
            class="nav-item" 
            [class.active]="activeSection === item.key">
          <a href="javascript:void(0)" 
             (click)="showSection(item.key)" 
             class="nav-link">
            <i [class]="item.icon"></i>
            <span class="nav-text" *ngIf="isSidebarExpanded">{{ item.label }}</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <!-- Logout Button -->
      <a href="javascript:void(0)" 
         (click)="logout()" 
         class="logout-link">
        <i class="bi bi-box-arrow-right"></i>
        <span class="nav-text" *ngIf="isSidebarExpanded">Log out</span>
      </a>

      <!-- Toggle Button -->
      <div class="sidebar-toggle-container">
        <button class="sidebar-toggle" 
                (click)="toggleSidebar()" 
                [title]="isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar'"
                [attr.aria-label]="isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar'">
          <i class="bi" [class.bi-chevron-left]="isSidebarExpanded" [class.bi-chevron-right]="!isSidebarExpanded"></i>
          <span class="visually-hidden">{{ isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar' }}</span>
        </button>
      </div>
    </div>
  </aside>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content" [class.sidebar-expanded]="isSidebarExpanded" [class.sidebar-collapsed]="!isSidebarExpanded">
    <div class="container py-4">
      <!-- ðŸ”” ALERT MESSAGE -->
      <div id="alertBox" class="alert fade text-center " role="alert">
        {{ message }}
      </div>

  <!-- ===================== OVERVIEW SECTION ===================== -->
  <div *ngIf="activeSection === 'overview'">
    <!-- Section Header with Navigation -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-speedometer2 me-2"></i>Dashboard Overview
          </h4>
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('signature')" title="Go to Signature">
              <i class="bi bi-pencil-square me-1"></i>Signature
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('leave')" title="Go to Leave Requests">
              <i class="bi bi-calendar2-check me-1"></i>Leave
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('history')" title="Go to History">
              <i class="bi bi-clock-history me-1"></i>History
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Welcome Header -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 overview-header-card">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <h3 class="fw-bold text-primary mb-2">
              <i class="bi bi-speedometer2 me-2"></i>Dashboard Overview
            </h3>
            <p class="text-muted mb-0">Welcome back, {{ intern.name }}! Here's a summary of your attendance and leave requests.</p>
          </div>
          <div class="col-12 col-md-4 text-end mt-3 mt-md-0">
            <span class="badge bg-primary-subtle text-primary px-3 py-2 fs-6">
              <i class="bi bi-calendar3 me-1"></i>{{ currentDate }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== OVERVIEW CARDS ===== -->
    <div class="row g-3 mb-4 overview-cards-horizontal">
      <div class="col overview-card-col" *ngFor="let stat of overviewStats; let i = index">
        <div
          class="card overview-stat-card improved-stat-card shadow-lg border-0 rounded-4 h-100 position-relative overflow-hidden cursor-pointer"
          [class]="'stat-card-' + stat.color + ' stat-card-' + (i + 1)"
          (click)="handleStatCardClick(stat)"
          [title]="stat.description"
          [attr.data-bs-toggle]="stat.description ? 'tooltip' : null"
          [attr.data-bs-placement]="'top'">
          
          <!-- Background Decorative Element -->
          <div class="stat-card-bg-decoration" [class]="'bg-' + stat.color"></div>
          

          <div class="card-body p-3 position-relative">
            <!-- Centered Content for Horizontal Layout -->
            <div class="text-center">
              <!-- Icon Section -->
              <div class="stat-icon-container mb-3 d-flex justify-content-center">
                <div class="stat-icon-improved stat-icon-horizontal" [class]="'bg-gradient-' + stat.color">
                  <i [class]="stat.icon" class="stat-icon-inner"></i>
                </div>
              </div>

              <!-- Value Section -->
              <div class="mb-2">
                <h6 class="fw-semibold text-muted mb-1 text-uppercase small letter-spacing-1">{{ stat.label }}</h6>
                <p class="fs-3 fw-bold mb-1 stat-value" [class]="'text-' + stat.color">
                  {{ stat.value }}
                </p>
                <p class="text-muted small mb-0" *ngIf="stat.subtitle">
                  {{ stat.subtitle }}
                </p>
              </div>

              <!-- Trend Indicator -->
              <div class="mb-2" *ngIf="stat.trend && stat.trend !== 'neutral'">
                <i [class]="stat.trend === 'up' ? 'bi bi-arrow-up-circle-fill text-success fs-5' : 'bi bi-arrow-down-circle-fill text-danger fs-5'"></i>
              </div>

              <!-- Progress Bar (for attendance percentage) -->
              <div class="stat-progress-section mb-2" *ngIf="stat.progress !== undefined">
                <div class="progress progress-improved">
                  <div 
                    class="progress-bar progress-bar-improved" 
                    [class]="'bg-' + stat.color"
                    [style.width.%]="stat.progress"
                    role="progressbar"
                    [attr.aria-valuenow]="stat.progress"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    [attr.aria-label]="getProgressBarLabel(stat)"
                    title="Progress bar"
                    [attr.title]="getProgressBarLabel(stat)"
                    [attr.aria-valuetext]="(stat.progress || 0) + '%'">
                  </div>
                </div>
              </div>

              <!-- Description -->
              <div class="stat-description" *ngIf="stat.description">
                <small class="text-muted d-block stat-description-text">
                  {{ stat.description }}
                </small>
              </div>

              <!-- Action Icon -->
              <div class="stat-action-icon-center mt-2" *ngIf="stat.action">
                <i class="bi bi-arrow-right-circle text-muted"></i>
              </div>
            </div>
          </div>

          <!-- Hover Overlay -->
          <div class="stat-hover-overlay"></div>
        </div>
      </div>
    </div>

    <!-- ===== RECENT ATTENDANCE TABLE ===== -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 overview-table-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-clock-history me-2"></i>Recent Attendance
            </h5>
            <p class="text-muted small mb-0">Your recent attendance records</p>
          </div>
          <div class="mt-2 mt-md-0">
            <button class="btn btn-primary btn-sm" (click)="showSection('history')">
              <i class="bi bi-arrow-right me-1"></i>View All
            </button>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 overview-table">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Date</th>
                <th>Day</th>
                <th>Time In</th>
                <th>Time Out</th>
                <th>Location</th>
                <th class="text-center pe-4">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of recentAttendanceLogs">
                <td class="ps-4">
                  <div class="fw-semibold">{{ log.date | date:'yyyy-MM-dd' }}</div>
                </td>
                <td>
                  <small class="text-muted">{{ log.date | date:'EEEE' }}</small>
                </td>
                <td>
                  <span class="badge bg-info-subtle text-info" *ngIf="log.timeIn">
                    {{ log.timeIn | date:'HH:mm' }}
                  </span>
                  <span class="text-muted" *ngIf="!log.timeIn">-</span>
                </td>
                <td>
                  <span class="badge bg-info-subtle text-info" *ngIf="log.timeOut">
                    {{ log.timeOut | date:'HH:mm' }}
                  </span>
                  <span class="text-muted" *ngIf="!log.timeOut">-</span>
                </td>
                <td>
                  <small class="text-muted">{{ log.location || '-' }}</small>
                </td>
                <td class="text-center pe-4">
                  <span class="badge rounded-pill px-3 py-1"
                    [ngClass]="{
                      'bg-success': getAttendanceStatus(log.date) === 'Present',
                      'bg-warning text-dark': getAttendanceStatus(log.date) === 'Left Early',
                      'bg-primary': getAttendanceStatus(log.date) === 'On Leave',
                      'bg-danger': getAttendanceStatus(log.date) === 'Absent'
                    }">
                    {{ getAttendanceStatus(log.date) }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="recentAttendanceLogs.length === 0">
                <td colspan="6" class="text-center text-muted py-5">
                  <i class="bi bi-inbox fs-1 d-block mb-2 opacity-25"></i>
                  <p class="mb-0">No attendance records found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ===== RECENT LEAVE REQUESTS TABLE ===== -->
    <div class="card shadow-sm border-0 mb-4 rounded-4 overview-table-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
          <div>
            <h5 class="text-primary fw-bold mb-1">
              <i class="bi bi-calendar-check me-2"></i>Recent Leave Requests
            </h5>
            <p class="text-muted small mb-0">Your recent leave requests</p>
          </div>
          <div class="mt-2 mt-md-0">
            <button class="btn btn-primary btn-sm" (click)="showSection('leave')">
              <i class="bi bi-arrow-right me-1"></i>View All
            </button>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0 overview-table">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Type</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Attachment</th>
                <th class="text-center pe-4">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leave of recentLeaveRequests">
                <td class="ps-4">
                  <div class="fw-semibold">{{ leave.type }}</div>
                </td>
                <td>
                  <small class="fw-medium">{{ leave.startDate | date:'yyyy-MM-dd' }}</small>
                </td>
                <td>
                  <small class="fw-medium">{{ leave.endDate | date:'yyyy-MM-dd' }}</small>
                </td>
                <td>
                  <small class="text-muted">{{ leave.attachment || '-' }}</small>
                </td>
                <td class="text-center pe-4">
                  <span class="badge rounded-pill px-3 py-1"
                    [ngClass]="{
                      'bg-success': leave.status === 'Approved',
                      'bg-warning text-dark': leave.status === 'Pending',
                      'bg-danger': leave.status === 'Declined'
                    }">
                    {{ leave.status }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="recentLeaveRequests.length === 0">
                <td colspan="5" class="text-center text-muted py-5">
                  <i class="bi bi-calendar-x fs-1 d-block mb-2 opacity-25"></i>
                  <p class="mb-0">No leave requests found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== SIGNATURE SECTION ===== -->
  <div *ngIf="activeSection === 'signature'">
    <!-- Section Header with Navigation -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-pencil-square me-2"></i>Signature & Sign-In
          </h4>
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('overview')" title="Go to Overview">
              <i class="bi bi-speedometer2 me-1"></i>Overview
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('leave')" title="Go to Leave Requests">
              <i class="bi bi-calendar2-check me-1"></i>Leave
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('history')" title="Go to History">
              <i class="bi bi-clock-history me-1"></i>History
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Allowed Locations List -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <h5 class="fw-bold text-primary mb-3">
          <i class="bi bi-geo-alt-fill me-2"></i>Allowed Sign-In Locations
        </h5>
      </div>
      <div class="card-body p-4">
        <!-- Empty State -->
        <div *ngIf="locations.length === 0" class="text-center py-5">
          <i class="bi bi-geo-alt locations-empty-icon"></i>
          <p class="text-muted mt-3 mb-0">No locations configured yet</p>
          <p class="text-muted small">Please contact your administrator to set up allowed sign-in locations</p>
        </div>

        <!-- Small Map -->
        <div *ngIf="locations.length > 0 && currentLocation" class="mb-4">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pb-2">
              <h6 class="fw-bold text-primary mb-0">
                <i class="bi bi-map me-2"></i>Your Location & Distance
              </h6>
            </div>
            <div class="card-body p-0">
              <div id="intern-location-map" class="small-location-map"></div>
              <div class="p-3 bg-light">
                <div class="row g-2 text-center">
                  <div class="col-6" *ngFor="let location of locations">
                    <small class="text-muted d-block">{{ location.name }}</small>
                    <strong class="text-primary" *ngIf="currentLocation">
                      {{ getDistanceToLocation(location) | number:'1.0-0' }}m
                    </strong>
                    <span class="badge bg-success-subtle text-success small" *ngIf="isWithinLocation(location)">
                      <i class="bi bi-check-circle me-1"></i>Within range
                    </span>
                    <span class="badge bg-danger-subtle text-danger small" *ngIf="!isWithinLocation(location)">
                      <i class="bi bi-x-circle me-1"></i>Out of range
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Locations List -->
        <div *ngIf="locations.length > 0" class="locations-list">
          <div *ngFor="let location of locations" class="location-item mb-3">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div class="flex-grow-1">
                <h6 class="fw-bold text-dark mb-1">
                  <i class="bi bi-geo-alt-fill text-primary me-2"></i>{{ location.name }}
                </h6>
                <p class="text-muted small mb-1" *ngIf="location.description">{{ location.description }}</p>
                <div class="d-flex flex-wrap gap-2">
                  <span class="badge bg-info-subtle text-info">
                    <i class="bi bi-rulers me-1"></i>{{ location.radius }}m radius
                  </span>
                  <span class="badge bg-secondary-subtle text-secondary">
                    <i class="bi bi-geo me-1"></i>{{ location.latitude.toFixed(4) }}, {{ location.longitude.toFixed(4) }}
                  </span>
                  <span class="badge bg-success-subtle text-success" *ngIf="currentLocation && isWithinLocation(location)">
                    <i class="bi bi-check-circle me-1"></i>You are here
                  </span>
                  <span class="badge bg-warning-subtle text-warning" *ngIf="currentLocation && !isWithinLocation(location)">
                    <i class="bi bi-rulers me-1"></i>{{ getDistanceToLocation(location) | number:'1.0-0' }}m away
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Signature and Sign-In Card -->
    <div class="card shadow-sm p-3 p-md-4 mb-4">
      <h4 class="mb-3 text-primary"><i class="bi bi-pencil-square me-2"></i> Digital Signature</h4>

      <!-- Saved Signature Accordion -->
      <div class="accordion mb-3" id="signatureAccordion">
        <div class="accordion-item border-0">
          <h2 class="accordion-header" id="headingSignature">
            <button class="accordion-button collapsed text-black" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSignature" aria-expanded="false" aria-controls="collapseSignature">
              <i class="bi bi-pencil me-2"></i> Saved Signature
            </button>
          </h2>
          <div id="collapseSignature" class="accordion-collapse collapse" aria-labelledby="headingSignature" data-bs-parent="#signatureAccordion">
            <div class="accordion-body text-center">
              <ng-container *ngIf="savedSignature; else noSig">
                <img [src]="savedSignature" alt="Saved Signature" class="img-fluid signature-preview">
              </ng-container>
              <ng-template #noSig>
                <p class="text-muted mt-2">No signature saved yet</p>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <!-- Signature Pad Controls -->
      <div class="d-flex justify-content-center gap-2 mb-3 flex-wrap">
        <button class="btn btn-outline-primary rounded-5 btn-sm" (click)="toggleSignaturePad()">
          <i class="bi bi-pencil me-1"></i> {{ isPadVisible ? 'Close Pad' : 'Open Signature Pad' }}
        </button>
      </div>

      <!-- Canvas -->
      <div *ngIf="isPadVisible" class="text-center mb-3">
        <div class="signature-container position-relative w-100">
          <canvas #signaturePad class="w-100 h-100 border rounded"></canvas>
          <span class="placeholder-text position-absolute top-50 start-50 translate-middle text-muted">Please Sign here</span>
        </div>
        <div class="d-flex justify-content-center gap-2 mt-3 flex-wrap">
          <button class="btn btn-success btn-sm rounded-5" (click)="saveSignature()">
            <i class="bi bi-check-circle me-1"></i> Save
          </button>
          <button class="btn btn-outline-danger btn-sm rounded-5" (click)="clearSignature()">
            <i class="bi bi-eraser me-1"></i> Clear
          </button>
        </div>
      </div>

      <!-- Sign In/Out Buttons -->
      <div class="d-flex justify-content-center gap-2 flex-wrap mt-3">
        <button
          *ngIf="!signedInToday"
          class="btn btn-success btn-sm rounded-5"
          (click)="signIn()"
          [disabled]="signedInToday || !canSignInNow() || !isWithinAllowedLocation()"
          [title]="signedInToday ? 'Already signed in today' : !canSignInNow() ? 'Sign in after 08:00' : !isWithinAllowedLocation() ? 'You must be within an allowed location to sign in' : ''">
          <i class="bi bi-box-arrow-in-right me-1"></i> Sign In
        </button>

        <button
          *ngIf="signedInToday && !signedOutToday"
          class="btn btn-danger btn-sm rounded-5"
          (click)="signOut()"
          [disabled]="!signedInToday || signedOutToday">
          <i class="bi bi-box-arrow-left me-1"></i> Sign Out
        </button>

        <button *ngIf="signedInToday && !signedOutToday" class="btn btn-warning btn-sm rounded-5" (click)="clearTodayRegister()">
          <i class="bi bi-trash me-1"></i> Clear Today's Register
        </button>
      </div>

      <!-- Time Alert for Sign In -->
      <div class="mt-2" *ngIf="!signedInToday && isBeforeSignInTime()">
        <div class="alert alert-warning mb-0">
          <i class="bi bi-clock me-2"></i>
          <strong>Sign-in Time:</strong> Sign-in is only available from 08:00 AM onwards. Please wait until 8:00 AM to sign in.
        </div>
      </div>

      <!-- Location Status Alerts -->
      <div class="mt-3">
        <div class="alert alert-info mb-2">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Location Required:</strong> You must be within one of the allowed locations below to sign in. Your current location will be checked automatically.
        </div>
        <div class="alert alert-success mb-2" *ngIf="currentLocation && isWithinAllowedLocation()">
          <i class="bi bi-check-circle me-2"></i>
          <strong>Location Valid:</strong> You are within an allowed sign-in location ({{ nearestLocationName }}).
        </div>
        <div class="alert alert-warning mb-0" *ngIf="!currentLocation">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Location Detection:</strong> Please allow location access to enable sign-in functionality.
        </div>
      </div>
    </div>

    <!-- Attendance Log Table -->
    <div class="card shadow-sm p-3 p-md-4 mb-4">
      <h4 class="mb-3"><i class="bi bi-clock-history me-2"></i> Register Table</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle mb-0">
          <thead class="table-light">
          <tr>
            <th>Signature</th>
            <th>Day</th>
            <th>Date</th>
            <th>Location</th>
            <th>Time In</th>
            <th>Time Out</th>
            <th>Status</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let log of getFullWeekLogs() | slice:0:5">
            <td><img [src]="log.image" alt="Signature" class="img-fluid signature-img"></td>
            <td class="text-center">{{ log.date | date:'EEEE' }}</td>
            <td class="text-center">{{ log.date | date:'yyyy-MM-dd' }}</td>
            <td class="text-center">{{ log.location || '-' }}</td>
            <td class="text-center">{{ log.timeIn ? (log.timeIn | date:'HH:mm') : '-' }}</td>
            <td class="text-center">{{ log.timeOut ? (log.timeOut | date:'HH:mm') : '-' }}</td>

            <!-- âœ… Dynamic Status Column -->
            <td class="text-center">
          <span class="badge"
                [ngClass]="{
                  'bg-success': getAttendanceStatus(log.date) === 'Present',
                  'bg-warning text-dark': getAttendanceStatus(log.date) === 'Left Early',
                  'bg-primary': getAttendanceStatus(log.date) === 'On Leave',
                  'bg-danger': getAttendanceStatus(log.date) === 'Absent'
                }">
            {{ getAttendanceStatus(log.date) }}
          </span>
            </td>
          </tr>
          <tr *ngIf="weekFilteredLogs.length === 0">
            <td colspan="7" class="text-center text-muted">No attendance records for this week (Monâ€“Fri).</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>


  <!-- ===== LEAVE REQUEST SECTION ===== -->
  <div *ngIf="activeSection === 'leave'">
    <!-- Section Header with Navigation -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-calendar2-check me-2"></i>Leave Requests
          </h4>
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('overview')" title="Go to Overview">
              <i class="bi bi-speedometer2 me-1"></i>Overview
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('signature')" title="Go to Signature">
              <i class="bi bi-pencil-square me-1"></i>Signature
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('history')" title="Go to History">
              <i class="bi bi-clock-history me-1"></i>History
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Leave Request Form Card -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 leave-request-card">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <h4 class="fw-bold text-primary mb-0">
          <i class="bi bi-calendar-plus me-2"></i>Request Leave
        </h4>
        <p class="text-muted small mb-0 mt-2">Fill in the form below to submit a leave request</p>
      </div>
      <div class="card-body p-4">

      <form (ngSubmit)="submitLeaveRequest()">
        <div class="row g-3">
          <div class="col-12 col-md-4">
            <label for="leaveType" class="form-label">Leave Type</label>
            <select id="leaveType" class="form-select" [(ngModel)]="leaveType" name="leaveType" title="Select leave type">
              <option value="" disabled selected>Select type</option>
              <option>Annual Leave</option>
              <option>Sick Leave</option>
              <option>Family Responsibility</option>
              <option>Study Leave</option>
            </select>
          </div>
          <div class="col-12 col-md-4">
            <label for="startDate" class="form-label">Start Date</label>
            <input id="startDate" type="date" class="form-control" [(ngModel)]="startDate" name="startDate" title="Leave start date">
          </div>
          <div class="col-12 col-md-4">
            <label for="endDate" class="form-label">End Date</label>
            <input id="endDate" type="date" class="form-control" [(ngModel)]="endDate" name="endDate" title="Leave end date">
          </div>
          <div class="col-12 col-md-6">
            <label for="leaveAttachment" class="form-label">Attach Document</label>
            <input id="leaveAttachment" type="file" (change)="onFileSelect($event)" class="form-control" accept=".pdf,.jpg,.png,.doc,.docx" title="Attach leave document">
          </div>
        </div>

        <div class="text-end mt-3">
          <button type="button" class="btn btn-outline-success rounded-5" (click)="submitLeaveRequest()">
            <i class="bi bi-check-circle me-1"></i> Submit Request
          </button>
        </div>
      </form>
      </div>
    </div>

    <!-- Leave History Table -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div>
            <h5 class="fw-bold text-primary mb-0">
              <i class="bi bi-clock-history me-2"></i>Leave Request History
            </h5>
            <p class="text-muted small mb-0 mt-1">{{ leaveRequests.length }} request(s) found</p>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <!-- Filter by Status -->
            <select class="form-select form-select-sm leave-filter-select" [(ngModel)]="leaveFilterStatus" (change)="filterLeaveRequests()" title="Filter leave requests by status">
              <option value="">All Status</option>
              <option value="Pending">Pending</option>
              <option value="Approved">Approved</option>
              <option value="Declined">Declined</option>
            </select>
            <!-- Search -->
            <input 
              type="text" 
              class="form-control form-control-sm leave-search-input" 
              placeholder="Search..." 
              [(ngModel)]="leaveSearchQuery"
              (input)="filterLeaveRequests()"
              title="Search leave requests">
          </div>
        </div>
      </div>
      <div class="card-body p-4">
        <!-- Empty State -->
        <div *ngIf="filteredLeaveRequests.length === 0" class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted mb-3"></i>
          <h5 class="text-muted mb-2">No Leave Requests</h5>
          <p class="text-muted small mb-0">
            {{ leaveRequests.length === 0 ? 'You haven\'t submitted any leave requests yet.' : 'No requests match your filters.' }}
          </p>
        </div>
        <div class="table-responsive" *ngIf="filteredLeaveRequests.length > 0">
        <table class="table table-bordered table-hover align-middle mb-0">
          <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Start</th>
            <th>End</th>
            <th>Attachment</th>
            <th>Status</th>
            <th>Reason</th> <!-- âœ… NEW COLUMN -->
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let leave of filteredLeaveRequests">
            <td>{{ leave.id }}</td>
            <td>{{ leave.type }}</td>
            <td>{{ leave.startDate | date }}</td>
            <td>{{ leave.endDate | date }}</td>
            <td>{{ leave.attachment }}</td>
            <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-success': leave.status === 'Approved',
                    'bg-warning text-dark': leave.status === 'Pending',
                    'bg-danger': leave.status === 'Declined'
                  }">
              {{ leave.status }}
            </span>
            </td>
            <td>
              <!-- âœ… Show reason if declined -->
              <span *ngIf="leave.reason; else noReason">{{ leave.reason }}</span>
              <ng-template #noReason>
                <span class="text-muted">-</span>
              </ng-template>
            </td>
          </tr>

          <tr *ngIf="filteredLeaveRequests.length === 0">
            <td colspan="7" class="text-center text-muted">No leave requests found.</td>
          </tr>
          </tbody>
        </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ATTENDANCE HISTORY & REPORTS ===== -->
  <div *ngIf="activeSection === 'history'">
    <!-- Section Header with Navigation -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-clock-history me-2"></i>Attendance History & Reports
          </h4>
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('overview')" title="Go to Overview">
              <i class="bi bi-speedometer2 me-1"></i>Overview
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('signature')" title="Go to Signature">
              <i class="bi bi-pencil-square me-1"></i>Signature
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="showSection('leave')" title="Go to Leave Requests">
              <i class="bi bi-calendar2-check me-1"></i>Leave
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Attendance Statistics Summary -->
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100 attendance-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-check-circle-fill text-success fs-3 mb-2"></i>
            <h4 class="mb-0 fw-bold">{{ getAttendanceStats().present }}</h4>
            <small class="text-muted">Present</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100 attendance-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-x-circle-fill text-danger fs-3 mb-2"></i>
            <h4 class="mb-0 fw-bold">{{ getAttendanceStats().absent }}</h4>
            <small class="text-muted">Absent</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100 attendance-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-calendar-check-fill text-primary fs-3 mb-2"></i>
            <h4 class="mb-0 fw-bold">{{ getAttendanceStats().onLeave }}</h4>
            <small class="text-muted">On Leave</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100 attendance-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-clock-fill text-warning fs-3 mb-2"></i>
            <h4 class="mb-0 fw-bold">{{ getAttendanceStats().leftEarly }}</h4>
            <small class="text-muted">Left Early</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters & Attendance Table -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
          <div>
            <h4 class="fw-bold text-primary mb-0">
              <i class="bi bi-clock-history me-2"></i>Attendance History
            </h4>
            <p class="text-muted small mb-0 mt-1">{{ filteredLogs.length }} record(s) found</p>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <!-- Quick Date Range Presets -->
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="setDateRange('today')" title="Today">
                Today
              </button>
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="setDateRange('week')" title="This Week">
                Week
              </button>
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="setDateRange('month')" title="This Month">
                Month
              </button>
            </div>
          </div>
        </div>

        <!-- Filter Controls -->
        <div class="row g-3 mb-3">
          <div class="col-12 col-md-3">
            <label for="filterStartDate" class="form-label fw-semibold small">
              <i class="bi bi-calendar-event text-primary me-1"></i>From Date
            </label>
            <input
              id="filterStartDate"
              type="date"
              class="form-control form-control-sm"
              [(ngModel)]="filterStartDate"
              name="filterStartDate"
              (change)="onFilterDateChange()"
              title="Filter start date"
            />
          </div>

          <div class="col-12 col-md-3">
            <label for="filterEndDate" class="form-label fw-semibold small">
              <i class="bi bi-calendar-check text-primary me-1"></i>To Date
            </label>
            <input
              id="filterEndDate"
              type="date"
              class="form-control form-control-sm"
              [(ngModel)]="filterEndDate"
              name="filterEndDate"
              (change)="onFilterDateChange()"
              title="Filter end date"
            />
          </div>

          <div class="col-12 col-md-3">
            <label for="attendanceStatusFilter" class="form-label fw-semibold small">
              <i class="bi bi-funnel text-primary me-1"></i>Status
            </label>
            <select
              id="attendanceStatusFilter"
              class="form-select form-select-sm"
              [(ngModel)]="attendanceStatusFilter"
              (change)="filterHistory()"
              title="Filter by status">
              <option value="">All Status</option>
              <option value="Present">Present</option>
              <option value="Absent">Absent</option>
              <option value="On Leave">On Leave</option>
              <option value="Left Early">Left Early</option>
            </select>
          </div>

          <div class="col-12 col-md-3">
            <label for="attendanceSearch" class="form-label fw-semibold small">
              <i class="bi bi-search text-primary me-1"></i>Search
            </label>
            <input
              id="attendanceSearch"
              type="text"
              class="form-control form-control-sm"
              placeholder="Search by location..."
              [(ngModel)]="attendanceSearchQuery"
              (input)="filterHistory()"
              title="Search attendance records"
            />
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
          <button
            class="btn btn-sm btn-outline-secondary rounded-4"
            (click)="resetFilter()"
            title="Reset filters">
            <i class="bi bi-arrow-repeat me-1"></i>Reset
          </button>
          <div class="text-muted small">
            <i class="bi bi-info-circle me-1"></i>Showing records from {{ getFilterDateRange() }}
          </div>
        </div>
      </div>

      <div class="card-body p-4">
        <!-- Empty State -->
        <div *ngIf="filteredLogs.length === 0" class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted mb-3"></i>
          <h5 class="text-muted mb-2">No Attendance Records</h5>
          <p class="text-muted small mb-0">
            {{ logs.length === 0 ? 'You haven\'t signed in yet. Start by signing in from the Signature section.' : 'No records match your filters. Try adjusting your search criteria.' }}
          </p>
        </div>

        <!-- Mobile Card View -->
        <div *ngIf="filteredLogs.length > 0" class="row g-3 d-md-none">
          <div class="col-12" *ngFor="let record of getAttendanceRecords()">
            <div class="card border shadow-sm attendance-record-card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h6 class="fw-bold mb-1">{{ record.date | date:'EEEE, MMM dd, yyyy' }}</h6>
                    <span class="badge attendance-status-badge"
                          [ngClass]="{
                            'bg-success': record.status === 'Present',
                            'bg-warning text-dark': record.status === 'Left Early',
                            'bg-primary': record.status === 'On Leave',
                            'bg-danger': record.status === 'Absent'
                          }">
                      <i [class]="getStatusIcon(record.status)" class="me-1"></i>{{ record.status }}
                    </span>
                  </div>
                  <img [src]="record.image" alt="Signature" class="attendance-signature-thumb" *ngIf="record.image">
                </div>
                <div class="row g-2 mb-2">
                  <div class="col-6">
                    <small class="text-muted d-block">Time In</small>
                    <strong>{{ record.timeIn ? (record.timeIn | date:'HH:mm') : '-' }}</strong>
                  </div>
                  <div class="col-6">
                    <small class="text-muted d-block">Time Out</small>
                    <strong>{{ record.timeOut ? (record.timeOut | date:'HH:mm') : '-' }}</strong>
                  </div>
                  <div class="col-6" *ngIf="record.duration">
                    <small class="text-muted d-block">Duration</small>
                    <strong class="text-primary">{{ record.duration }}</strong>
                  </div>
                  <div class="col-6" *ngIf="record.location">
                    <small class="text-muted d-block">Location</small>
                    <strong>{{ record.location }}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Desktop Table View -->
        <div *ngIf="filteredLogs.length > 0" class="table-responsive d-none d-md-block">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Day</th>
                <th>Time In</th>
                <th>Time Out</th>
                <th>Duration</th>
                <th>Location</th>
                <th>Status</th>
                <th>Signature</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of getAttendanceRecords()" class="attendance-record-row">
                <td>
                  <strong>{{ record.date | date:'MMM dd, yyyy' }}</strong>
                </td>
                <td>
                  <span class="badge bg-light text-dark">
                    {{ record.date | date:'EEEE' }}
                  </span>
                </td>
                <td>
                  <i class="bi bi-arrow-down-circle text-success me-1"></i>
                  <strong>{{ record.timeIn ? (record.timeIn | date:'HH:mm') : '-' }}</strong>
                </td>
                <td>
                  <i class="bi bi-arrow-up-circle text-danger me-1"></i>
                  <strong>{{ record.timeOut ? (record.timeOut | date:'HH:mm') : '-' }}</strong>
                </td>
                <td>
                  <span class="badge bg-info-subtle text-info" *ngIf="record.duration">
                    <i class="bi bi-clock me-1"></i>{{ record.duration }}
                  </span>
                  <span class="text-muted" *ngIf="!record.duration">-</span>
                </td>
                <td>
                  <span class="badge bg-light text-dark" *ngIf="record.location">
                    <i class="bi bi-geo-alt me-1"></i>{{ record.location }}
                  </span>
                  <span class="text-muted" *ngIf="!record.location">-</span>
                </td>
                <td>
                  <span class="badge attendance-status-badge"
                        [ngClass]="{
                          'bg-success': record.status === 'Present',
                          'bg-warning text-dark': record.status === 'Left Early',
                          'bg-primary': record.status === 'On Leave',
                          'bg-danger': record.status === 'Absent'
                        }">
                    <i [class]="getStatusIcon(record.status)" class="me-1"></i>{{ record.status }}
                  </span>
                </td>
                <td>
                  <img [src]="record.image" alt="Signature" class="attendance-signature-img" *ngIf="record.image" (click)="viewSignature(record.image)">
                  <span class="text-muted" *ngIf="!record.image">-</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>



    <!-- ======== REPORTS SECTION ======== -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
          <div>
            <h4 class="fw-bold text-success mb-0">
              <i class="bi bi-file-earmark-text me-2"></i>Generate Reports
            </h4>
            <p class="text-muted small mb-0 mt-1">Generate and download attendance reports in PDF or Excel format</p>
          </div>
        </div>
      </div>

      <div class="card-body p-4">
        <!-- Report Preview Statistics -->
        <div *ngIf="reportLogs.length > 0" class="row g-3 mb-4">
          <div class="col-6 col-md-3">
            <div class="card border-0 bg-light h-100 report-stat-card">
              <div class="card-body text-center p-3">
                <i class="bi bi-calendar-check text-primary fs-4 mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ getReportStats().totalDays }}</h5>
                <small class="text-muted">Total Days</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 bg-light h-100 report-stat-card">
              <div class="card-body text-center p-3">
                <i class="bi bi-check-circle text-success fs-4 mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ getReportStats().present }}</h5>
                <small class="text-muted">Present</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 bg-light h-100 report-stat-card">
              <div class="card-body text-center p-3">
                <i class="bi bi-x-circle text-danger fs-4 mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ getReportStats().absent }}</h5>
                <small class="text-muted">Absent</small>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card border-0 bg-light h-100 report-stat-card">
              <div class="card-body text-center p-3">
                <i class="bi bi-percent text-info fs-4 mb-2"></i>
                <h5 class="mb-0 fw-bold">{{ getReportStats().attendanceRate }}%</h5>
                <small class="text-muted">Attendance Rate</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Date Range Selection -->
        <div class="row g-3 mb-4">
          <div class="col-12">
            <label class="form-label fw-semibold">
              <i class="bi bi-calendar-range text-primary me-2"></i>Quick Date Range Presets
            </label>
            <div class="btn-group w-100" role="group">
              <button type="button" class="btn btn-outline-primary" (click)="setReportDateRange('today')" title="Today">
                <i class="bi bi-calendar-day me-1"></i>Today
              </button>
              <button type="button" class="btn btn-outline-primary" (click)="setReportDateRange('week')" title="This Week">
                <i class="bi bi-calendar-week me-1"></i>This Week
              </button>
              <button type="button" class="btn btn-outline-primary" (click)="setReportDateRange('month')" title="This Month">
                <i class="bi bi-calendar-month me-1"></i>This Month
              </button>
              <button type="button" class="btn btn-outline-primary" (click)="setReportDateRange('quarter')" title="This Quarter">
                <i class="bi bi-calendar3 me-1"></i>Quarter
              </button>
              <button type="button" class="btn btn-outline-primary" (click)="setReportDateRange('year')" title="This Year">
                <i class="bi bi-calendar-year me-1"></i>Year
              </button>
            </div>
          </div>

          <div class="col-12 col-md-6">
            <label for="reportStartDate" class="form-label fw-semibold">
              <i class="bi bi-calendar-event text-primary me-2"></i>From Date <span class="text-danger">*</span>
            </label>
            <input
              id="reportStartDate"
              type="date"
              class="form-control form-control-lg"
              [(ngModel)]="reportStartDate"
              name="reportStartDate"
              [max]="reportEndDate || getReportMaxDate()"
              (change)="onReportDateChange()"
              title="Report start date"
              required
            />
            <small class="text-muted d-block mt-1">
              <i class="bi bi-info-circle me-1"></i>Select the start date for the report
            </small>
          </div>

          <div class="col-12 col-md-6">
            <label for="reportEndDate" class="form-label fw-semibold">
              <i class="bi bi-calendar-check text-primary me-2"></i>To Date <span class="text-danger">*</span>
            </label>
            <input
              id="reportEndDate"
              type="date"
              class="form-control form-control-lg"
              [(ngModel)]="reportEndDate"
              name="reportEndDate"
              [min]="reportStartDate || getReportMinDate()"
              [max]="getReportMaxDate()"
              (change)="onReportDateChange()"
              title="Report end date"
              required
            />
            <small class="text-muted d-block mt-1">
              <i class="bi bi-info-circle me-1"></i>Select the end date for the report
            </small>
          </div>
        </div>

        <!-- Report Options -->
        <div class="card border-0 bg-light mb-4">
          <div class="card-body p-3">
            <h6 class="fw-bold mb-3">
              <i class="bi bi-gear text-primary me-2"></i>Report Options
            </h6>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeStatus" [(ngModel)]="reportIncludeWeekends" name="includeStatus">
                  <label class="form-check-label" for="includeStatus">
                    Include Status
                  </label>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeSignatures" [(ngModel)]="reportIncludeSignatures" name="includeSignatures" checked>
                  <label class="form-check-label" for="includeSignatures">
                    Include Signatures
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Report Summary -->
        <div *ngIf="reportLogs.length > 0" class="alert alert-info border-0 mb-4">
          <div class="d-flex align-items-start">
            <i class="bi bi-info-circle-fill me-3 fs-4 mt-1"></i>
            <div class="flex-grow-1">
              <h6 class="fw-bold mb-2">Report Summary</h6>
              <div class="row g-2">
                <div class="col-6 col-md-3">
                  <small class="text-muted d-block">Date Range</small>
                  <strong>{{ reportStartDate | date:'MMM dd, yyyy' }} - {{ reportEndDate | date:'MMM dd, yyyy' }}</strong>
                </div>
                <div class="col-6 col-md-3">
                  <small class="text-muted d-block">Total Records</small>
                  <strong>{{ reportLogs.length }}</strong>
                </div>
                <div class="col-6 col-md-3">
                  <small class="text-muted d-block">Working Days</small>
                  <strong>{{ getReportStats().workingDays }}</strong>
                </div>
                <div class="col-6 col-md-3">
                  <small class="text-muted d-block">Attendance Rate</small>
                  <strong class="text-success">{{ getReportStats().attendanceRate }}%</strong>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
          <div class="d-flex gap-2 flex-wrap">
            <button
              class="btn btn-primary btn-lg rounded-4"
              (click)="generateReport()"
              [disabled]="!reportStartDate || !reportEndDate"
              title="Generate report">
              <i class="bi bi-file-earmark-text me-2"></i>Generate Report
            </button>
            <button
              class="btn btn-outline-secondary btn-lg rounded-4"
              (click)="resetReportFilter()"
              title="Reset filters">
              <i class="bi bi-arrow-repeat me-2"></i>Reset
            </button>
          </div>
        </div>

        <!-- Download Buttons (Always Visible) -->
        <div class="d-flex flex-wrap justify-content-center gap-3 mt-4 pt-4 border-top">
          <div class="text-center w-100 mb-2">
            <h6 class="fw-semibold text-muted mb-0">
              <i class="bi bi-download text-primary me-2"></i>Export Report
            </h6>
            <small class="text-muted">Generate a report first to enable download options</small>
          </div>
          <button
            class="btn btn-danger btn-lg rounded-4"
            (click)="downloadReportPDF()"
            [disabled]="reportLogs.length === 0"
            [title]="reportLogs.length === 0 ? 'Please generate a report first' : 'Download PDF report'">
            <i class="bi bi-file-earmark-pdf-fill me-2"></i>Download PDF Report
          </button>
          <button
            class="btn btn-success btn-lg rounded-4"
            (click)="downloadReportExcel()"
            [disabled]="reportLogs.length === 0"
            [title]="reportLogs.length === 0 ? 'Please generate a report first' : 'Download Excel report'">
            <i class="bi bi-file-earmark-excel-fill me-2"></i>Download Excel Report
          </button>
        </div>

        <!-- Preview Table -->
        <div *ngIf="reportLogs.length > 0" class="mt-4">
          <h6 class="fw-bold mb-3">
            <i class="bi bi-eye text-primary me-2"></i>Report Preview
          </h6>
          <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Date</th>
                  <th>Day</th>
                  <th>Time In</th>
                  <th>Time Out</th>
                  <th>Duration</th>
                  <th>Location</th>
                  <th *ngIf="reportIncludeWeekends">Status</th>
                  <th>Signature</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let record of getReportRecords()" class="report-preview-row">
                  <td>{{ record.date | date:'MMM dd, yyyy' }}</td>
                  <td>
                    <span class="badge bg-light text-dark">{{ record.date | date:'EEEE' }}</span>
                  </td>
                  <td>
                    <i class="bi bi-arrow-down-circle text-success me-1"></i>
                    {{ record.timeIn ? (record.timeIn | date:'HH:mm') : '-' }}
                  </td>
                  <td>
                    <i class="bi bi-arrow-up-circle text-danger me-1"></i>
                    {{ record.timeOut ? (record.timeOut | date:'HH:mm') : '-' }}
                  </td>
                  <td>
                    <span class="badge bg-info-subtle text-info" *ngIf="record.duration">
                      {{ record.duration }}
                    </span>
                    <span class="text-muted" *ngIf="!record.duration">-</span>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark" *ngIf="record.location && record.location !== '-'">
                      <i class="bi bi-geo-alt me-1"></i>{{ record.location }}
                    </span>
                    <span class="text-muted" *ngIf="!record.location || record.location === '-'">-</span>
                  </td>
                  <td *ngIf="reportIncludeWeekends">
                    <span class="badge report-status-badge"
                          [ngClass]="{
                            'bg-success': record.status === 'Present',
                            'bg-warning text-dark': record.status === 'Left Early',
                            'bg-primary': record.status === 'On Leave',
                            'bg-danger': record.status === 'Absent'
                          }">
                      <i [class]="getStatusIcon(record.status)" class="me-1"></i>{{ record.status }}
                    </span>
                  </td>
                  <td class="text-center">
                    <img *ngIf="record.image" [src]="record.image" alt="Signature" class="report-signature-img">
                    <span class="text-muted" *ngIf="!record.image">-</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="reportLogs.length === 0 && reportStartDate && reportEndDate" class="text-center py-5">
          <i class="bi bi-file-earmark-text display-1 text-muted mb-3"></i>
          <h5 class="text-muted mb-2">No Report Data</h5>
          <p class="text-muted small mb-0">Click "Generate Report" to create a report for the selected date range.</p>
        </div>
      </div>
    </div>
  </div>
    </div>
  </main>
</div>
